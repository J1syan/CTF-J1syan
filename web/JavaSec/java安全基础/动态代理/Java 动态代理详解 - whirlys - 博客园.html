<!DOCTYPE html>
<!-- saved from url=(0046)https://www.cnblogs.com/whirly/p/10154887.html -->
<html lang="zh-cn" style="--olcb-folder-code-block-max-height:80vh;"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="never">
    <meta name="description" content="动态代理在Java中有着广泛的应用，比如Spring AOP、Hibernate数据查询、测试框架的后端mock、RPC远程调用、Java注解对象获取、日志、用户鉴权、全局性异常处理、性能监控，甚至事">
    <meta property="og:description" content="动态代理在Java中有着广泛的应用，比如Spring AOP、Hibernate数据查询、测试框架的后端mock、RPC远程调用、Java注解对象获取、日志、用户鉴权、全局性异常处理、性能监控，甚至事">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Java 动态代理详解 - whirlys - 博客园</title>
    <link id="favicon" rel="shortcut icon" href="https://common.cnblogs.com/favicon.svg" type="image/svg+xml">
    
    <style>#home :not(.cnblogs_code):not(.cnblogs_Highlighter)>pre:not([highlighted]):not([class*="brush:"]) code:not(.hljs), :not(.cnblogs_code):not(.cnblogs_Highlighter)>pre:not([highlighted]):not([class*="brush:"]) code:not(.hljs) {background: rgb(245, 245, 245);
        padding: 12px;
        border: 1px solid rgb(204, 204, 204);
        border-radius: 3px;
        border-color: transparent;
        color: rgb(68, 68, 68);
        font-family: "Courier New", sans-serif;
        font-size: 12px</style><link rel="stylesheet" href="./Java 动态代理详解 - whirlys - 博客园_files/blog-common.min.css">
    

    <link id="MainCss" rel="stylesheet" href="./Java 动态代理详解 - whirlys - 博客园_files/bundle-codinglife.min.css">
        <link id="highlighter-theme-cnblogs" type="text/css" rel="stylesheet" href="./Java 动态代理详解 - whirlys - 博客园_files/cnblogs.css">
    
    
    <link id="mobile-style" media="only screen and (max-width: 767px)" type="text/css" rel="stylesheet" href="./Java 动态代理详解 - whirlys - 博客园_files/bundle-codinglife-mobile.min.css">
    
    <link type="application/rss+xml" rel="alternate" href="https://www.cnblogs.com/whirly/rss">
    <link type="application/rsd+xml" rel="EditURI" href="https://www.cnblogs.com/whirly/rsd.xml">
    <link type="application/wlwmanifest+xml" rel="wlwmanifest" href="https://www.cnblogs.com/whirly/wlwmanifest.xml">
    <script>
        var currentBlogId = 387481;
        var currentBlogApp = 'whirly';
        var isLogined = true;
        var isBlogOwner = false;
        var skinName = 'CodingLife';
        var visitorUserId = 'b59721fd-9503-45e3-8717-08da8e583326';
        var hasCustomScript = false;
        try {
            if (hasCustomScript && document.referrer && document.referrer.indexOf('baidu.com') >= 0) {
                Object.defineProperty(document, 'referrer', { value: '' });
                Object.defineProperty(Document.prototype, 'referrer', { get: function(){ return ''; } });
            }
        } catch(error) { }
        window.cb_enable_mathjax = false;
        window.mathEngine = 0;
        window.codeHighlightEngine = 1;
        window.enableCodeLineNumber = false;
        window.codeHighlightTheme = 'cnblogs';
        window.darkModeCodeHighlightTheme = 'vs2015';
        window.isDarkCodeHighlightTheme = false;
        window.isDarkModeCodeHighlightThemeDark = true;
        window.isDisableCodeHighlighter = false;
        window.enableCodeThemeTypeFollowSystem = false;
    </script>
        <script>
            var currentPostDateAdded = '2018-12-21 11:41';
        </script>
    <script src="./Java 动态代理详解 - whirlys - 博客园_files/jquery-2.2.0.min.js.下载"></script>
    <script src="./Java 动态代理详解 - whirlys - 博客园_files/blog-common.min.js.下载"></script><style>.medium-zoom-overlay {
  position: fixed;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  opacity: 0;
  transition: opacity 300ms;
  will-change: opacity;
}

.medium-zoom--opened .medium-zoom-overlay {
  cursor: pointer;
  cursor: zoom-out;
  opacity: 1;
}

.medium-zoom-image {
  cursor: pointer;
  cursor: zoom-in;
  /*
    The `transition` is marked as "!important" for the animation to happen
    even though it's overriden by another inline `transition` style attribute.

    This is problematic with frameworks that generate inline styles on their
    images (e.g. Gatsby).

    See https://github.com/francoischalifour/medium-zoom/issues/110
   */
  transition: transform 300ms cubic-bezier(0.2, 0, 0.2, 1) !important;
}

.medium-zoom-image--hidden {
  visibility: hidden;
}

.medium-zoom-image--opened {
  position: relative;
  cursor: pointer;
  cursor: zoom-out;
  will-change: transform;
}
</style><script id="hljs-script" src="./Java 动态代理详解 - whirlys - 博客园_files/highlight.min.js.下载" type="text/javascript" async=""></script>
    

    
</head>
<body class="skin-codinglife has-navbar hljs-engine">
<a name="top"></a>
<div id="top_nav" class="navbar forpc">
    <nav id="nav_main" class="navbar-main">
        <ul id="nav_left" class="navbar-list navbar-left">
            <li class="navbar-branding">
                <a href="https://www.cnblogs.com/" title="开发者的网上家园" role="banner">
                    <img src="./Java 动态代理详解 - whirlys - 博客园_files/logo.svg" alt="博客园Logo">
                </a>
            </li>
            <li>
                <a href="https://www.cnblogs.com/" onclick="countClicks(&#39;skin-navbar-sitehome&#39;)">首页</a>
            </li>
            <li>
                <a href="https://news.cnblogs.com/" onclick="countClicks(&#39;nav&#39;, &#39;skin-navbar-news&#39;)">新闻</a>
            </li>
            <li>
                <a href="https://q.cnblogs.com/" onclick="countClicks(&#39;nav&#39;, &#39;skin-navbar-q&#39;)">博问</a>
            </li>
            <li>
                <a id="nav_brandzone" href="https://brands.cnblogs.com/" onclick="countClicks(&#39;nav&#39;, &#39;skin-navbar-brands&#39;)">专区</a>
            </li>
            <li>
                <a href="https://ing.cnblogs.com/" onclick="countClicks(&#39;nav&#39;, &#39;skin-navbar-ing&#39;)">闪存</a>
            </li>
            <li>
                <a href="https://edu.cnblogs.com/" onclick="countClicks(&#39;nav&#39;, &#39;skin-navbar-edu&#39;)">班级</a>
            </li>
        </ul>
        <ul id="nav_right" class="navbar-list navbar-right">
            <li>
                <form id="zzk_search" class="navbar-search" action="https://zzk.cnblogs.com/s" method="get" role="search">
                    <input name="w" id="zzk_search_input" placeholder="代码改变世界" type="search" tabindex="3">
                    <button type="submit" id="zzk_search_button">
                        <img src="./Java 动态代理详解 - whirlys - 博客园_files/search.svg" alt="搜索">
                    </button>
                </form>
            </li>
            <li id="navbar_login_status" class="navbar-list">
                <a class="navbar-user-info navbar-blog" href="https://i.cnblogs.com/EditPosts.aspx?opt=1" alt="写随笔" title="写随笔" style="display: inline;">
                    <img id="new_post_icon" class="navbar-icon" src="./Java 动态代理详解 - whirlys - 博客园_files/newpost.svg" alt="写随笔">
                </a>
                <a id="navblog-myblog-icon" class="navbar-user-info navbar-blog" href="https://account.cnblogs.com/blog-apply" alt="我的博客" title="我的博客" style="display: inline;">
                    <img id="myblog_icon" class="navbar-icon" src="./Java 动态代理详解 - whirlys - 博客园_files/myblog.svg" alt="我的博客">
                </a>
                <a class="navbar-user-info navbar-message navbar-icon-wrapper" href="https://msg.cnblogs.com/" alt="短消息" title="短消息" style="display: inline;">
                    <img id="msg_icon" class="navbar-icon" src="./Java 动态代理详解 - whirlys - 博客园_files/message.svg" alt="短消息">
                    <span id="msg_count" style="display: none"></span>
                </a>
                <a id="navbar_lite_mode_indicator" data-current-page="blog" style="display: none" href="javascript:void(0)" alt="简洁模式" title="简洁模式启用，您在访问他人博客时会使用简洁款皮肤展示">
                    <img class="navbar-icon" src="./Java 动态代理详解 - whirlys - 博客园_files/lite-mode-on.svg" alt="简洁模式">
                </a>
                <div id="user_info" class="navbar-user-info dropdown" style="display: block;">
                    <a class="dropdown-button" href="https://home.cnblogs.com/u/2973000">
                        <img id="user_icon" class="navbar-avatar" src="./Java 动态代理详解 - whirlys - 博客园_files/20220905184829.png" alt="用户头像">
                    </a>
                    <div class="dropdown-menu">
                        <a id="navblog-myblog-text" href="https://account.cnblogs.com/blog-apply">我的博客</a>
                        <a href="https://home.cnblogs.com/">我的园子</a>
                        <a href="https://account.cnblogs.com/settings/account">账号设置</a>
                        <a href="javascript:void(0)" id="navbar_lite_mode_toggle" title="简洁模式会使用简洁款皮肤显示所有博客">
    简洁模式 <img id="navbar_lite_mode_on" src="./Java 动态代理详解 - whirlys - 博客园_files/lite-mode-check.svg" class="hide" style="display: none;"><span id="navbar_lite_mode_spinner" class="hide">...</span>
</a>
                        <a href="javascript:void(0)" onclick="account.logout();">退出登录</a>
                    </div>
                </div>
                <a class="navbar-anonymous" href="https://account.cnblogs.com/signup" style="display: none;">注册</a>
                <a class="navbar-anonymous" href="javascript:void(0);" onclick="account.login()" style="display: none;">登录</a>
            </li>
        </ul>
    </nav>
</div>



<!--done-->
<div id="home">
<div id="header">
	<div id="blogTitle">
        <a id="lnkBlogLogo" href="https://www.cnblogs.com/whirly/"><img id="blogLogo" src="./Java 动态代理详解 - whirlys - 博客园_files/logo.gif" alt="返回主页"></a>		
		
<!--done-->
<h1><a id="Header1_HeaderTitle" class="headermaintitle HeaderMainTitle" href="https://www.cnblogs.com/whirly/">小旋锋</a>
</h1>
<h2>本博客分享内容涵盖Java后端，大数据技术等，公众号【小旋锋】，欢迎关注，一起成长</h2>




		
	</div><!--end: blogTitle 博客的标题和副标题 -->
	<div id="navigator">
		
<ul id="navList">
<li>
</li>
<li>

</li>
<li>

<a id="blog_nav_newpost" class="menu" href="https://i.cnblogs.com/EditPosts.aspx?opt=1">
新随笔</a>
</li>
<li>
<a id="blog_nav_contact" class="menu" href="https://msg.cnblogs.com/send/whirlys">
联系</a></li>
<li>
<a id="blog_nav_rss" class="menu" href="javascript:void(0)" data-rss="https://www.cnblogs.com/whirly/rss/">订阅</a>
<!--<partial name="./Shared/_XmlLink.cshtml" model="Model" /></li>--></li>
<li>
<a id="blog_nav_admin" class="menu" href="https://i.cnblogs.com/">
管理</a>
</li>
</ul>


		<div class="blogStats">
			<span id="stats_post_count">随笔 - 10&nbsp; </span>
<span id="stats_article_count">文章 - 0&nbsp; </span>
<span id="stats-comment_count">评论 - 7&nbsp; </span>
<span id="stats-total-view-count">阅读 - 
<span title="总阅读数: 63364">
63364</span></span>

		</div><!--end: blogStats -->
	</div><!--end: navigator 博客导航栏 -->
</div><!--end: header 头部 -->
<div id="main">
	<div id="mainContent">
	<div class="forFlow">
		<div id="post_detail">
    <!--done-->
    <div id="topics">
        <div class="post">
            <h1 class="postTitle">
                
<a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/whirly/p/10154887.html">
    <span role="heading" aria-level="2">Java 动态代理详解</span>
    
</a><button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>动态代理在Java中有着广泛的应用，比如Spring AOP、Hibernate数据查询、测试框架的后端mock、RPC远程调用、Java注解对象获取、日志、用户鉴权、全局性异常处理、性能监控，甚至事务处理等。</p>
<p>本文主要介绍Java中两种常见的动态代理方式：JDK原生动态代理和CGLIB动态代理。</p>
<p>由于Java动态代理与java反射机制关系紧密，请读者确保已经了解了Java反射机制，可参考上一篇文章《<a href="https://mp.weixin.qq.com/s?__biz=MzI1NDU0MTE1NA==&amp;mid=2247483785&amp;idx=1&amp;sn=f696c8c49cb7ecce9818247683482a1c&amp;chksm=e9c2ed84deb564925172b2dd78d307d4dc345fa313d3e44f01e84fa22ac5561b37aec5cbd5b4&amp;scene=0#rd" target="_blank" rel="noopener">Java反射机制详解</a>》</p>
<h3 id="代理模式">代理模式<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h3>
<p>本文将介绍的Java动态代理与设计模式中的代理模式有关，什么是代理模式呢？</p>
<p><strong>代理模式</strong>：给某一个对象提供一个代理，并由代理对象来控制对真实对象的访问。代理模式是一种结构型设计模式。</p>
<p>代理模式角色分为 3 种：</p>
<p><strong>Subject（抽象主题角色）</strong>：定义代理类和真实主题的公共对外方法，也是代理类代理真实主题的方法；</p>
<p><strong>RealSubject（真实主题角色</strong>）：真正实现业务逻辑的类；</p>
<p><strong>Proxy（代理主题角色）</strong>：用来代理和封装真实主题；</p>
<p>代理模式的结构比较简单，其核心是代理类，为了让客户端能够<strong>一致性地对待</strong>真实对象和代理对象，在代理模式中引入了抽象层</p>
<p><img src="./Java 动态代理详解 - whirlys - 博客园_files/2018_12_20_proxyUML.jpg" alt="代理模式类图" loading="lazy"></p>
<p>代理模式<strong>按照职责</strong>（使用场景）来分类，至少可以分为以下几类：1、远程代理。 2、虚拟代理。 3、Copy-on-Write 代理。 4、保护（Protect or Access）代理。 5、Cache代理。 6、防火墙（Firewall）代理。 7、同步化（Synchronization）代理。 8、智能引用（Smart Reference）代理等等。</p>
<p>如果<strong>根据字节码的创建时机</strong>来分类，可以分为静态代理和动态代理：</p>
<ul>
<li>所谓<strong>静态</strong>也就是在<strong>程序运行前</strong>就已经存在代理类的<strong>字节码文件</strong>，代理类和真实主题角色的关系在运行前就确定了。</li>
<li>而动态代理的源码是在程序运行期间由<strong>JVM</strong>根据反射等机制<strong>动态的生成</strong>，所以在运行前并不存在代理类的字节码文件</li>
</ul>
<h3 id="静态代理">静态代理<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h3>
<p>我们先通过实例来学习静态代理，然后理解静态代理的缺点，再来学习本文的主角：动态代理</p>
<p>编写一个接口 UserService ，以及该接口的一个实现类 UserServiceImpl</p>
<pre class="highlighter-hljs" highlighted="true"><code class="language-java highlighter-hljs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">select</span><span class="hljs-params">()</span>;   
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">()</span>;
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserService</span> {  
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">select</span><span class="hljs-params">()</span> {  
        System.out.println(<span class="hljs-string">"查询 selectById"</span>);
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"更新 update"</span>);
    }
}
</code></pre>
<p>我们将通过静态代理对 UserServiceImpl 进行功能增强，在调用 <code>select</code> 和 <code>update</code> 之前记录一些日志。写一个代理类 UserServiceProxy，代理类需要实现 UserService</p>
<pre class="highlighter-hljs" highlighted="true"><code class="language-java highlighter-hljs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceProxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-keyword">private</span> UserService target; <span class="hljs-comment">// 被代理的对象</span>

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UserServiceProxy</span><span class="hljs-params">(UserService target)</span> {
        <span class="hljs-built_in">this</span>.target = target;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">select</span><span class="hljs-params">()</span> {
        before();
        target.select();    <span class="hljs-comment">// 这里才实际调用真实主题角色的方法</span>
        after();
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">()</span> {
        before();
        target.update();    <span class="hljs-comment">// 这里才实际调用真实主题角色的方法</span>
        after();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">before</span><span class="hljs-params">()</span> {     <span class="hljs-comment">// 在执行方法之前执行</span>
        System.out.println(String.format(<span class="hljs-string">"log start time [%s] "</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()));
    }
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">after</span><span class="hljs-params">()</span> {      <span class="hljs-comment">// 在执行方法之后执行</span>
        System.out.println(String.format(<span class="hljs-string">"log end time [%s] "</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()));
    }
}
</code></pre>
<p>客户端测试</p>
<pre class="highlighter-hljs" highlighted="true"><code class="language-java highlighter-hljs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client1</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">UserService</span> <span class="hljs-variable">userServiceImpl</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserServiceImpl</span>();
        <span class="hljs-type">UserService</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserServiceProxy</span>(userServiceImpl);

        proxy.select();
        proxy.update();
    }
}
</code></pre>
<p>输出</p>
<pre class="highlighter-hljs" highlighted="true"><code class="highlighter-hljs hljs language-sql">log <span class="hljs-keyword">start</span> <span class="hljs-type">time</span> [Thu <span class="hljs-type">Dec</span> <span class="hljs-number">20</span> <span class="hljs-number">14</span>:<span class="hljs-number">13</span>:<span class="hljs-number">25</span> CST <span class="hljs-number">2018</span>] 
查询 selectById
log <span class="hljs-keyword">end</span> <span class="hljs-type">time</span> [Thu <span class="hljs-type">Dec</span> <span class="hljs-number">20</span> <span class="hljs-number">14</span>:<span class="hljs-number">13</span>:<span class="hljs-number">25</span> CST <span class="hljs-number">2018</span>] 
log <span class="hljs-keyword">start</span> <span class="hljs-type">time</span> [Thu <span class="hljs-type">Dec</span> <span class="hljs-number">20</span> <span class="hljs-number">14</span>:<span class="hljs-number">13</span>:<span class="hljs-number">25</span> CST <span class="hljs-number">2018</span>] 
更新 <span class="hljs-keyword">update</span>
log <span class="hljs-keyword">end</span> <span class="hljs-type">time</span> [Thu <span class="hljs-type">Dec</span> <span class="hljs-number">20</span> <span class="hljs-number">14</span>:<span class="hljs-number">13</span>:<span class="hljs-number">25</span> CST <span class="hljs-number">2018</span>] 
</code></pre>
<p>通过静态代理，我们达到了功能增强的目的，而且没有侵入原代码，这是静态代理的一个优点。</p>
<h4 id="静态代理的缺点">静态代理的缺点<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h4>
<p>虽然静态代理实现简单，且不侵入原代码，但是，当场景稍微复杂一些的时候，静态代理的缺点也会暴露出来。</p>
<p>1、 当需要代理多个类的时候，由于代理对象要实现与目标对象一致的接口，有两种方式：</p>
<ul>
<li>只维护一个代理类，由这个代理类实现多个接口，但是这样就导致<strong>代理类过于庞大</strong></li>
<li>新建多个代理类，每个目标对象对应一个代理类，但是这样会<strong>产生过多的代理类</strong></li>
</ul>
<p>2、 当接口需要增加、删除、修改方法的时候，目标对象与代理类都要同时修改，<strong>不易维护</strong>。</p>
<h4 id="如何改进">如何改进？<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h4>
<p>当然是让代理类<strong>动态的生成</strong>啦，也就是动态代理。</p>
<p><strong>为什么类可以动态的生成？</strong></p>
<p>这就涉及到Java虚拟机的<strong>类加载机制</strong>了，推荐翻看《深入理解Java虚拟机》7.3节 类加载的过程。</p>
<p>Java虚拟机类加载过程主要分为五个阶段：加载、验证、准备、解析、初始化。其中加载阶段需要完成以下3件事情：</p>
<ol>
<li>通过一个类的全限定名来获取定义此类的二进制字节流</li>
<li>将这个字节流所代表的静态存储结构转化为方法区的运行时数据结构</li>
<li>在内存中生成一个代表这个类的 <code>java.lang.Class</code> 对象，作为方法区这个类的各种数据访问入口</li>
</ol>
<p>由于虚拟机规范对这3点要求并不具体，所以实际的实现是非常灵活的，关于第1点，<strong>获取类的二进制字节流</strong>（class字节码）就有很多途径：</p>
<ul>
<li>从ZIP包获取，这是JAR、EAR、WAR等格式的基础</li>
<li>从网络中获取，典型的应用是 Applet</li>
<li><strong>运行时计算生成</strong>，这种场景使用最多的是动态代理技术，在 java.lang.reflect.Proxy 类中，就是用了 ProxyGenerator.generateProxyClass 来为特定接口生成形式为 <code>*$Proxy</code> 的代理类的二进制字节流</li>
<li>由其它文件生成，典型应用是JSP，即由JSP文件生成对应的Class类</li>
<li>从数据库中获取等等</li>
</ul>
<p>所以，动态代理就是想办法，根据接口或目标对象，计算出代理类的字节码，然后再加载到JVM中使用。但是如何计算？如何生成？情况也许比想象的复杂得多，我们需要借助现有的方案。</p>
<h4 id="常见的字节码操作类库">常见的字节码操作类库<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h4>
<blockquote>
<p>这里有一些介绍：<a href="https://java-source.net/open-source/bytecode-libraries" target="_blank" rel="noopener">https://java-source.net/open-source/bytecode-libraries</a></p>
</blockquote>
<ul>
<li>Apache BCEL (Byte Code Engineering Library)：是Java classworking广泛使用的一种框架，它可以深入到JVM汇编语言进行类操作的细节。</li>
<li>ObjectWeb ASM：是一个Java字节码操作框架。它可以用于直接以二进制形式动态生成stub根类或其他代理类，或者在加载时动态修改类。</li>
<li>CGLIB(Code Generation Library)：是一个功能强大，高性能和高质量的代码生成库，用于扩展JAVA类并在运行时实现接口。</li>
<li>Javassist：是Java的加载时反射系统，它是一个用于在Java中编辑字节码的类库; 它使Java程序能够在运行时定义新类，并在JVM加载之前修改类文件。</li>
<li>...</li>
</ul>
<h4 id="实现动态代理的思考方向">实现动态代理的思考方向<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h4>
<p>为了让生成的代理类与目标对象（真实主题角色）保持一致性，从现在开始将介绍以下两种最常见的方式：</p>
<ol>
<li>通过实现接口的方式 -&gt; JDK动态代理</li>
<li>通过继承类的方式 -&gt; CGLIB动态代理</li>
</ol>
<p>注：使用ASM对使用者要求比较高，使用Javassist会比较麻烦</p>
<h3 id="jdk动态代理">JDK动态代理<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h3>
<p>JDK动态代理主要涉及两个类：<code>java.lang.reflect.Proxy</code> 和 <code>java.lang.reflect.InvocationHandler</code>，我们仍然通过案例来学习</p>
<p>编写一个调用逻辑处理器 LogHandler 类，提供日志增强功能，并实现 InvocationHandler 接口；在 LogHandler 中维护一个目标对象，这个对象是被代理的对象（真实主题角色）；在 <code>invoke</code> 方法中编写方法调用的逻辑处理</p>
<pre class="highlighter-hljs" highlighted="true"><code class="language-java highlighter-hljs hljs"><span class="hljs-keyword">import</span> java.lang.reflect.InvocationHandler;
<span class="hljs-keyword">import</span> java.lang.reflect.Method;
<span class="hljs-keyword">import</span> java.util.Date;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InvocationHandler</span> {
    Object target;  <span class="hljs-comment">// 被代理的对象，实际的方法执行者</span>

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">LogHandler</span><span class="hljs-params">(Object target)</span> {
        <span class="hljs-built_in">this</span>.target = target;
    }
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable {
        before();
        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> method.invoke(target, args);  <span class="hljs-comment">// 调用 target 的 method 方法</span>
        after();
        <span class="hljs-keyword">return</span> result;  <span class="hljs-comment">// 返回方法的执行结果</span>
    }
    <span class="hljs-comment">// 调用invoke方法之前执行</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">before</span><span class="hljs-params">()</span> {
        System.out.println(String.format(<span class="hljs-string">"log start time [%s] "</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()));
    }
    <span class="hljs-comment">// 调用invoke方法之后执行</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">after</span><span class="hljs-params">()</span> {
        System.out.println(String.format(<span class="hljs-string">"log end time [%s] "</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()));
    }
}
</code></pre>
<p>编写客户端，获取动态生成的代理类的对象须借助 Proxy 类的 newProxyInstance 方法，具体步骤可见代码和注释</p>
<pre class="highlighter-hljs" highlighted="true"><code class="language-java highlighter-hljs hljs"><span class="hljs-keyword">import</span> proxy.UserService;
<span class="hljs-keyword">import</span> proxy.UserServiceImpl;
<span class="hljs-keyword">import</span> java.lang.reflect.InvocationHandler;
<span class="hljs-keyword">import</span> java.lang.reflect.Proxy;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client2</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IllegalAccessException, InstantiationException {
        <span class="hljs-comment">// 设置变量可以保存动态代理类，默认名称以 $Proxy0 格式命名</span>
        <span class="hljs-comment">// System.getProperties().setProperty("sun.misc.ProxyGenerator.saveGeneratedFiles", "true");</span>
        <span class="hljs-comment">// 1. 创建被代理的对象，UserService接口的实现类</span>
        <span class="hljs-type">UserServiceImpl</span> <span class="hljs-variable">userServiceImpl</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserServiceImpl</span>();
        <span class="hljs-comment">// 2. 获取对应的 ClassLoader</span>
        <span class="hljs-type">ClassLoader</span> <span class="hljs-variable">classLoader</span> <span class="hljs-operator">=</span> userServiceImpl.getClass().getClassLoader();
        <span class="hljs-comment">// 3. 获取所有接口的Class，这里的UserServiceImpl只实现了一个接口UserService，</span>
        Class[] interfaces = userServiceImpl.getClass().getInterfaces();
        <span class="hljs-comment">// 4. 创建一个将传给代理类的调用请求处理器，处理所有的代理对象上的方法调用</span>
        <span class="hljs-comment">//     这里创建的是一个自定义的日志处理器，须传入实际的执行对象 userServiceImpl</span>
        <span class="hljs-type">InvocationHandler</span> <span class="hljs-variable">logHandler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LogHandler</span>(userServiceImpl);
        <span class="hljs-comment">/*
		   5.根据上面提供的信息，创建代理对象 在这个过程中，
               a.JDK会通过根据传入的参数信息动态地在内存中创建和.class 文件等同的字节码
               b.然后根据相应的字节码转换成对应的class，
               c.然后调用newInstance()创建代理实例
		 */</span>
        <span class="hljs-type">UserService</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> (UserService) Proxy.newProxyInstance(classLoader, interfaces, logHandler);
        <span class="hljs-comment">// 调用代理的方法</span>
        proxy.select();
        proxy.update();
        
        <span class="hljs-comment">// 保存JDK动态代理生成的代理类，类名保存为 UserServiceProxy</span>
        <span class="hljs-comment">// ProxyUtils.generateClassFile(userServiceImpl.getClass(), "UserServiceProxy");</span>
    }
}
</code></pre>
<p>运行结果</p>
<pre class="highlighter-hljs" highlighted="true"><code class="highlighter-hljs hljs language-sql">log <span class="hljs-keyword">start</span> <span class="hljs-type">time</span> [Thu <span class="hljs-type">Dec</span> <span class="hljs-number">20</span> <span class="hljs-number">16</span>:<span class="hljs-number">55</span>:<span class="hljs-number">19</span> CST <span class="hljs-number">2018</span>] 
查询 selectById
log <span class="hljs-keyword">end</span> <span class="hljs-type">time</span> [Thu <span class="hljs-type">Dec</span> <span class="hljs-number">20</span> <span class="hljs-number">16</span>:<span class="hljs-number">55</span>:<span class="hljs-number">19</span> CST <span class="hljs-number">2018</span>] 
log <span class="hljs-keyword">start</span> <span class="hljs-type">time</span> [Thu <span class="hljs-type">Dec</span> <span class="hljs-number">20</span> <span class="hljs-number">16</span>:<span class="hljs-number">55</span>:<span class="hljs-number">19</span> CST <span class="hljs-number">2018</span>] 
更新 <span class="hljs-keyword">update</span>
log <span class="hljs-keyword">end</span> <span class="hljs-type">time</span> [Thu <span class="hljs-type">Dec</span> <span class="hljs-number">20</span> <span class="hljs-number">16</span>:<span class="hljs-number">55</span>:<span class="hljs-number">19</span> CST <span class="hljs-number">2018</span>] 
</code></pre>
<p>InvocationHandler 和 Proxy 的主要方法介绍如下：</p>
<p><strong>java.lang.reflect.InvocationHandler</strong></p>
<p><code>Object invoke(Object proxy, Method method, Object[] args)</code> 定义了代理对象调用方法时希望执行的动作，用于集中处理在动态代理类对象上的方法调用</p>
<p><strong>java.lang.reflect.Proxy</strong></p>
<p><code>static InvocationHandler getInvocationHandler(Object proxy)</code>  用于获取指定代理对象所关联的调用处理器</p>
<p><code>static Class&lt;?&gt; getProxyClass(ClassLoader loader, Class&lt;?&gt;... interfaces)</code> 返回指定接口的代理类</p>
<p><code>static Object newProxyInstance(ClassLoader loader, Class&lt;?&gt;[] interfaces, InvocationHandler h)</code> 构造实现指定接口的代理类的一个新实例，所有方法会调用给定处理器对象的 invoke 方法</p>
<p><code>static boolean isProxyClass(Class&lt;?&gt; cl)</code> 返回 cl 是否为一个代理类</p>
<h4 id="代理类的调用过程">代理类的调用过程<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h4>
<p>生成的代理类到底长什么样子呢？借助下面的工具类，把代理类保存下来再探个究竟<br>
（通过设置环境变量sun.misc.ProxyGenerator.saveGeneratedFiles=true也可以保存代理类）</p>
<pre class="highlighter-hljs" highlighted="true"><code class="language-java highlighter-hljs hljs"><span class="hljs-keyword">import</span> sun.misc.ProxyGenerator;
<span class="hljs-keyword">import</span> java.io.FileOutputStream;
<span class="hljs-keyword">import</span> java.io.IOException;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProxyUtils</span> {
    <span class="hljs-comment">/**
     * 将根据类信息动态生成的二进制字节码保存到硬盘中，默认的是clazz目录下
     * params: clazz 需要生成动态代理类的类
     * proxyName: 为动态生成的代理类的名称
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">generateClassFile</span><span class="hljs-params">(Class clazz, String proxyName)</span> {
        <span class="hljs-comment">// 根据类信息和提供的代理类名称，生成字节码</span>
        <span class="hljs-type">byte</span>[] classFile = ProxyGenerator.generateProxyClass(proxyName, clazz.getInterfaces());
        <span class="hljs-type">String</span> <span class="hljs-variable">paths</span> <span class="hljs-operator">=</span> clazz.getResource(<span class="hljs-string">"."</span>).getPath();
        System.out.println(paths);
        <span class="hljs-type">FileOutputStream</span> <span class="hljs-variable">out</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">//保留到硬盘中</span>
            out = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(paths + proxyName + <span class="hljs-string">".class"</span>);
            out.write(classFile);
            out.flush();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">try</span> {
                out.close();
            } <span class="hljs-keyword">catch</span> (IOException e) {
                e.printStackTrace();
            }
        }
    }
}
</code></pre>
<p>然后在 Client2 测试类的main的最后面加入一行代码</p>
<pre class="highlighter-hljs" highlighted="true"><code class="language-java highlighter-hljs hljs"><span class="hljs-comment">// 保存JDK动态代理生成的代理类，类名保存为 UserServiceProxy</span>
ProxyUtils.generateClassFile(userServiceImpl.getClass(), <span class="hljs-string">"UserServiceProxy"</span>);
</code></pre>
<p>IDEA 再次运行之后就可以在 target 的类路径下找到 UserServiceProxy.class，双击后IDEA的反编译插件会将该二进制class文件</p>
<p><img src="./Java 动态代理详解 - whirlys - 博客园_files/20181220_171031.png" alt="JDK 动态代理生成的代理类" loading="lazy"></p>
<p>UserServiceProxy 的代码如下所示：</p>
<pre class="highlighter-hljs" highlighted="true"><code class="language-java highlighter-hljs hljs"><span class="hljs-keyword">import</span> java.lang.reflect.InvocationHandler;
<span class="hljs-keyword">import</span> java.lang.reflect.Method;
<span class="hljs-keyword">import</span> java.lang.reflect.Proxy;
<span class="hljs-keyword">import</span> java.lang.reflect.UndeclaredThrowableException;
<span class="hljs-keyword">import</span> proxy.UserService;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceProxy</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Proxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Method m1;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Method m2;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Method m4;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Method m0;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Method m3;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UserServiceProxy</span><span class="hljs-params">(InvocationHandler var1)</span> <span class="hljs-keyword">throws</span>  {
        <span class="hljs-built_in">super</span>(var1);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">equals</span><span class="hljs-params">(Object var1)</span> <span class="hljs-keyword">throws</span>  {
        <span class="hljs-comment">// 省略...</span>
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span>  {
        <span class="hljs-comment">// 省略...</span>
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">select</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span>  {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-built_in">super</span>.h.invoke(<span class="hljs-built_in">this</span>, m4, (Object[])<span class="hljs-literal">null</span>);
        } <span class="hljs-keyword">catch</span> (RuntimeException | Error var2) {
            <span class="hljs-keyword">throw</span> var2;
        } <span class="hljs-keyword">catch</span> (Throwable var3) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UndeclaredThrowableException</span>(var3);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">hashCode</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span>  {
        <span class="hljs-comment">// 省略...</span>
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span>  {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-built_in">super</span>.h.invoke(<span class="hljs-built_in">this</span>, m3, (Object[])<span class="hljs-literal">null</span>);
        } <span class="hljs-keyword">catch</span> (RuntimeException | Error var2) {
            <span class="hljs-keyword">throw</span> var2;
        } <span class="hljs-keyword">catch</span> (Throwable var3) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UndeclaredThrowableException</span>(var3);
        }
    }

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            m1 = Class.forName(<span class="hljs-string">"java.lang.Object"</span>).getMethod(<span class="hljs-string">"equals"</span>, Class.forName(<span class="hljs-string">"java.lang.Object"</span>));
            m2 = Class.forName(<span class="hljs-string">"java.lang.Object"</span>).getMethod(<span class="hljs-string">"toString"</span>);
            m4 = Class.forName(<span class="hljs-string">"proxy.UserService"</span>).getMethod(<span class="hljs-string">"select"</span>);
            m0 = Class.forName(<span class="hljs-string">"java.lang.Object"</span>).getMethod(<span class="hljs-string">"hashCode"</span>);
            m3 = Class.forName(<span class="hljs-string">"proxy.UserService"</span>).getMethod(<span class="hljs-string">"update"</span>);
        } <span class="hljs-keyword">catch</span> (NoSuchMethodException var2) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NoSuchMethodError</span>(var2.getMessage());
        } <span class="hljs-keyword">catch</span> (ClassNotFoundException var3) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NoClassDefFoundError</span>(var3.getMessage());
        }
    }
}
</code></pre>
<p>从 UserServiceProxy 的代码中我们可以发现：</p>
<ul>
<li>UserServiceProxy 继承了 Proxy 类，并且实现了被代理的所有接口，以及equals、hashCode、toString等方法</li>
<li>由于 UserServiceProxy 继承了 Proxy 类，所以每个代理类都会关联一个 InvocationHandler 方法调用处理器</li>
<li>类和所有方法都被 <code>public final</code> 修饰，所以代理类只可被使用，不可以再被继承</li>
<li>每个方法都有一个 Method 对象来描述，Method 对象在static静态代码块中创建，以 <code>m + 数字</code> 的格式命名</li>
<li>调用方法的时候通过 <code>super.h.invoke(this, m1, (Object[])null);</code> 调用，其中的 <code>super.h.invoke</code> 实际上是在创建代理的时候传递给 <code>Proxy.newProxyInstance</code> 的 LogHandler 对象，它继承 InvocationHandler 类，负责实际的调用处理逻辑</li>
</ul>
<p>而 LogHandler 的 invoke 方法接收到 method、args 等参数后，进行一些处理，然后通过反射让被代理的对象 target 执行方法</p>
<pre class="highlighter-hljs" highlighted="true"><code class="language-java highlighter-hljs hljs">    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable {
        before();
        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> method.invoke(target, args);       <span class="hljs-comment">// 调用 target 的 method 方法</span>
        after();
        <span class="hljs-keyword">return</span> result;  <span class="hljs-comment">// 返回方法的执行结果</span>
    }
</code></pre>
<p>JDK动态代理执行方法调用的过程简图如下：</p>
<p><img src="./Java 动态代理详解 - whirlys - 博客园_files/2018_12_20_JDKProxy.png" alt="JDK动态代理执行方法调用过程" loading="lazy"></p>
<p>代理类的调用过程相信大家都明了了，而关于Proxy的源码解析，还请大家另外查阅其他文章或者直接看源码</p>
<h3 id="cglib动态代理">CGLIB动态代理<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h3>
<p>maven引入CGLIB包，然后编写一个UserDao类，它没有接口，只有两个方法，select() 和 update()</p>
<pre class="highlighter-hljs" highlighted="true"><code class="language-java highlighter-hljs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDao</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">select</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"UserDao 查询 selectById"</span>);
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"UserDao 更新 update"</span>);
    }
}
</code></pre>
<p>编写一个 LogInterceptor ，继承了 MethodInterceptor，用于方法的拦截回调</p>
<pre class="highlighter-hljs" highlighted="true"><code class="language-java highlighter-hljs hljs"><span class="hljs-keyword">import</span> java.lang.reflect.Method;
<span class="hljs-keyword">import</span> java.util.Date;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MethodInterceptor</span> {
    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@param</span> object 表示要进行增强的对象
     * <span class="hljs-doctag">@param</span> method 表示拦截的方法
     * <span class="hljs-doctag">@param</span> objects 数组表示参数列表，基本数据类型需要传入其包装类型，如int--&gt;Integer、long-Long、double--&gt;Double
     * <span class="hljs-doctag">@param</span> methodProxy 表示对方法的代理，invokeSuper方法表示对被代理对象方法的调用
     * <span class="hljs-doctag">@return</span> 执行结果
     * <span class="hljs-doctag">@throws</span> Throwable
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(Object object, Method method, Object[] objects, MethodProxy methodProxy)</span> <span class="hljs-keyword">throws</span> Throwable {
        before();
        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> methodProxy.invokeSuper(object, objects);   <span class="hljs-comment">// 注意这里是调用 invokeSuper 而不是 invoke，否则死循环，methodProxy.invokesuper执行的是原始类的方法，method.invoke执行的是子类的方法</span>
        after();
        <span class="hljs-keyword">return</span> result;
    }
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">before</span><span class="hljs-params">()</span> {
        System.out.println(String.format(<span class="hljs-string">"log start time [%s] "</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()));
    }
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">after</span><span class="hljs-params">()</span> {
        System.out.println(String.format(<span class="hljs-string">"log end time [%s] "</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()));
    }
}
</code></pre>
<p>测试</p>
<pre class="highlighter-hljs" highlighted="true"><code class="language-java highlighter-hljs hljs"><span class="hljs-keyword">import</span> net.sf.cglib.proxy.Enhancer;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CglibTest</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">DaoProxy</span> <span class="hljs-variable">daoProxy</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DaoProxy</span>(); 
        <span class="hljs-type">Enhancer</span> <span class="hljs-variable">enhancer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Enhancer</span>();
        enhancer.setSuperclass(Dao.class);  <span class="hljs-comment">// 设置超类，cglib是通过继承来实现的</span>
        enhancer.setCallback(daoProxy);

        <span class="hljs-type">Dao</span> <span class="hljs-variable">dao</span> <span class="hljs-operator">=</span> (Dao)enhancer.create();   <span class="hljs-comment">// 创建代理类</span>
        dao.update();
        dao.select();
    }
}
</code></pre>
<p>运行结果</p>
<pre class="highlighter-hljs" highlighted="true"><code class="highlighter-hljs hljs language-sql">log <span class="hljs-keyword">start</span> <span class="hljs-type">time</span> [Fri <span class="hljs-type">Dec</span> <span class="hljs-number">21</span> <span class="hljs-number">00</span>:<span class="hljs-number">06</span>:<span class="hljs-number">40</span> CST <span class="hljs-number">2018</span>] 
UserDao 查询 selectById
log <span class="hljs-keyword">end</span> <span class="hljs-type">time</span> [Fri <span class="hljs-type">Dec</span> <span class="hljs-number">21</span> <span class="hljs-number">00</span>:<span class="hljs-number">06</span>:<span class="hljs-number">40</span> CST <span class="hljs-number">2018</span>] 
log <span class="hljs-keyword">start</span> <span class="hljs-type">time</span> [Fri <span class="hljs-type">Dec</span> <span class="hljs-number">21</span> <span class="hljs-number">00</span>:<span class="hljs-number">06</span>:<span class="hljs-number">40</span> CST <span class="hljs-number">2018</span>] 
UserDao 更新 <span class="hljs-keyword">update</span>
log <span class="hljs-keyword">end</span> <span class="hljs-type">time</span> [Fri <span class="hljs-type">Dec</span> <span class="hljs-number">21</span> <span class="hljs-number">00</span>:<span class="hljs-number">06</span>:<span class="hljs-number">40</span> CST <span class="hljs-number">2018</span>] 
</code></pre>
<p>还可以进一步多个 MethodInterceptor 进行过滤筛选</p>
<pre class="highlighter-hljs" highlighted="true"><code class="language-java highlighter-hljs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogInterceptor2</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MethodInterceptor</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(Object object, Method method, Object[] objects, MethodProxy methodProxy)</span> <span class="hljs-keyword">throws</span> Throwable {
        before();
        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> methodProxy.invokeSuper(object, objects);
        after();
        <span class="hljs-keyword">return</span> result;
    }
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">before</span><span class="hljs-params">()</span> {
        System.out.println(String.format(<span class="hljs-string">"log2 start time [%s] "</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()));
    }
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">after</span><span class="hljs-params">()</span> {
        System.out.println(String.format(<span class="hljs-string">"log2 end time [%s] "</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()));
    }
}

<span class="hljs-comment">// 回调过滤器: 在CGLib回调时可以设置对不同方法执行不同的回调逻辑，或者根本不执行回调。</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DaoFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">CallbackFilter</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">accept</span><span class="hljs-params">(Method method)</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-string">"select"</span>.equals(method.getName())) {
            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;   <span class="hljs-comment">// Callback 列表第1个拦截器</span>
        }
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;   <span class="hljs-comment">// Callback 列表第2个拦截器，return 2 则为第3个，以此类推</span>
    }
}
</code></pre>
<p>再次测试</p>
<pre class="highlighter-hljs" highlighted="true"><code class="language-java highlighter-hljs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CglibTest2</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">LogInterceptor</span> <span class="hljs-variable">logInterceptor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LogInterceptor</span>();
        <span class="hljs-type">LogInterceptor2</span> <span class="hljs-variable">logInterceptor2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LogInterceptor2</span>();
        <span class="hljs-type">Enhancer</span> <span class="hljs-variable">enhancer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Enhancer</span>();
        enhancer.setSuperclass(UserDao.class);   <span class="hljs-comment">// 设置超类，cglib是通过继承来实现的</span>
        enhancer.setCallbacks(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Callback</span>[]{logInterceptor, logInterceptor2, NoOp.INSTANCE});   <span class="hljs-comment">// 设置多个拦截器，NoOp.INSTANCE是一个空拦截器，不做任何处理</span>
        enhancer.setCallbackFilter(<span class="hljs-keyword">new</span> <span class="hljs-title class_">DaoFilter</span>());

        <span class="hljs-type">UserDao</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> (UserDao) enhancer.create();   <span class="hljs-comment">// 创建代理类</span>
        proxy.select();
        proxy.update();
    }
}
</code></pre>
<p>运行结果</p>
<pre class="highlighter-hljs" highlighted="true"><code class="language-java highlighter-hljs hljs">log start time [Fri Dec <span class="hljs-number">21</span> <span class="hljs-number">00</span>:<span class="hljs-number">22</span>:<span class="hljs-number">39</span> CST <span class="hljs-number">2018</span>] 
UserDao 查询 selectById
log end time [Fri Dec <span class="hljs-number">21</span> <span class="hljs-number">00</span>:<span class="hljs-number">22</span>:<span class="hljs-number">39</span> CST <span class="hljs-number">2018</span>] 
log2 start time [Fri Dec <span class="hljs-number">21</span> <span class="hljs-number">00</span>:<span class="hljs-number">22</span>:<span class="hljs-number">39</span> CST <span class="hljs-number">2018</span>] 
UserDao 更新 update
log2 end time [Fri Dec <span class="hljs-number">21</span> <span class="hljs-number">00</span>:<span class="hljs-number">22</span>:<span class="hljs-number">39</span> CST <span class="hljs-number">2018</span>] 
</code></pre>
<p>CGLIB 创建动态代理类的模式是：</p>
<ol>
<li>查找目标类上的所有非final 的public类型的方法定义；</li>
<li>将这些方法的定义转换成字节码；</li>
<li>将组成的字节码转换成相应的代理的class对象；</li>
<li>实现 MethodInterceptor接口，用来处理对代理类上所有方法的请求</li>
</ol>
<h3 id="jdk动态代理与cglib动态代理对比">JDK动态代理与CGLIB动态代理对比<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h3>
<p>JDK动态代理：基于Java反射机制实现，必须要实现了接口的业务类才能用这种办法生成代理对象。</p>
<p>cglib动态代理：基于ASM机制实现，通过生成业务类的子类作为代理类。</p>
<p>JDK Proxy 的优势：</p>
<ul>
<li>最小化依赖关系，减少依赖意味着简化开发和维护，JDK 本身的支持，可能比 cglib 更加可靠。</li>
<li>平滑进行 JDK 版本升级，而字节码类库通常需要进行更新以保证在新版 Java 上能够使用。</li>
<li>代码实现简单。</li>
</ul>
<p>基于类似 cglib 框架的优势：</p>
<ul>
<li>无需实现接口，达到代理类无侵入</li>
<li>只操作我们关心的类，而不必为其他相关类增加工作量。</li>
<li>高性能</li>
</ul>
<h3 id="面试题">面试题<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h3>
<blockquote>
<p>来源于网上，用于帮助理解和掌握，欢迎补充</p>
</blockquote>
<h4 id="描述动态代理的几种实现方式分别说出相应的优缺点">描述动态代理的几种实现方式？分别说出相应的优缺点<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h4>
<p>代理可以分为 "静态代理" 和 "动态代理"，动态代理又分为 "JDK动态代理" 和 "CGLIB动态代理" 实现。</p>
<p><strong>静态代理</strong>：代理对象和实际对象都继承了同一个接口，在代理对象中指向的是实际对象的实例，这样对外暴露的是代理对象而真正调用的是 Real Object</p>
<ul>
<li><strong>优点</strong>：可以很好的保护实际对象的业务逻辑对外暴露，从而提高安全性。</li>
<li><strong>缺点</strong>：不同的接口要有不同的代理类实现，会很冗余</li>
</ul>
<p><strong>JDK 动态代理</strong>：</p>
<ul>
<li>
<p>为了解决静态代理中，生成大量的代理类造成的冗余；</p>
</li>
<li>
<p>JDK 动态代理只需要实现 InvocationHandler 接口，重写 invoke 方法便可以完成代理的实现，</p>
</li>
<li>
<p>jdk的代理是利用反射生成代理类 Proxyxx.class 代理类字节码，并生成对象</p>
</li>
<li>
<p>jdk动态代理之所以<strong>只能代理接口</strong>是因为<strong>代理类本身已经extends了Proxy，而java是不允许多重继承的</strong>，但是允许实现多个接口</p>
</li>
<li>
<p><strong>优点</strong>：解决了静态代理中冗余的代理实现类问题。</p>
</li>
<li>
<p><strong>缺点</strong>：JDK 动态代理是基于接口设计实现的，如果没有接口，会抛异常。</p>
</li>
</ul>
<p><strong>CGLIB 代理</strong>：</p>
<ul>
<li>
<p>由于 JDK 动态代理限制了只能基于接口设计，而对于没有接口的情况，JDK方式解决不了；</p>
</li>
<li>
<p>CGLib 采用了非常底层的字节码技术，其原理是通过字节码技术为一个类创建子类，并在子类中采用方法拦截的技术拦截所有父类方法的调用，顺势织入横切逻辑，来完成动态代理的实现。</p>
</li>
<li>
<p>实现方式实现 MethodInterceptor 接口，重写 intercept 方法，通过 Enhancer 类的回调方法来实现。</p>
</li>
<li>
<p>但是CGLib在创建代理对象时所花费的时间却比JDK多得多，所以对于单例的对象，因为无需频繁创建对象，用CGLib合适，反之，使用JDK方式要更为合适一些。</p>
</li>
<li>
<p>同时，由于CGLib由于是采用动态创建子类的方法，对于final方法，无法进行代理。</p>
</li>
<li>
<p><strong>优点</strong>：没有接口也能实现动态代理，而且采用字节码增强技术，性能也不错。</p>
</li>
<li>
<p><strong>缺点</strong>：技术实现相对难理解些。</p>
</li>
</ul>
<h4 id="cglib-对接口实现代理">CGlib 对接口实现代理？<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h4>
<pre class="highlighter-hljs" highlighted="true"><code class="language-java highlighter-hljs hljs"><span class="hljs-keyword">import</span> net.sf.cglib.proxy.Enhancer;
<span class="hljs-keyword">import</span> net.sf.cglib.proxy.MethodInterceptor;
<span class="hljs-keyword">import</span> net.sf.cglib.proxy.MethodProxy;
<span class="hljs-keyword">import</span> proxy.UserService;
<span class="hljs-keyword">import</span> java.lang.reflect.Method;

<span class="hljs-comment">/**
 * 创建代理类的工厂 该类要实现 MethodInterceptor 接口。
 * 该类中完成三样工作：
 * （1）声明目标类的成员变量，并创建以目标类对象为参数的构造器。用于接收目标对象
 * （2）定义代理的生成方法，用于创建代理对象。方法名是任意的。代理对象即目标类的子类
 * （3）定义回调接口方法。对目标类的增强这在这里完成
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CGLibFactory</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MethodInterceptor</span> {
    <span class="hljs-comment">// 声明目标类的成员变量</span>
    <span class="hljs-keyword">private</span> UserService target;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">CGLibFactory</span><span class="hljs-params">(UserService target)</span> {
        <span class="hljs-built_in">this</span>.target = target;
    }
    <span class="hljs-comment">// 定义代理的生成方法,用于创建代理对象</span>
    <span class="hljs-keyword">public</span> UserService <span class="hljs-title function_">myCGLibCreator</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Enhancer</span> <span class="hljs-variable">enhancer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Enhancer</span>();
        <span class="hljs-comment">// 为代理对象设置父类，即指定目标类</span>
        enhancer.setSuperclass(UserService.class);
        <span class="hljs-comment">/**
         * 设置回调接口对象 注意，只所以在setCallback()方法中可以写上this，
         * 是因为MethodIntecepter接口继承自Callback，是其子接口
         */</span>
        enhancer.setCallback(<span class="hljs-built_in">this</span>);
        <span class="hljs-keyword">return</span> (UserService) enhancer.create();<span class="hljs-comment">// create用以生成CGLib代理对象</span>
    }
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(Object obj, Method method, Object[] args, MethodProxy proxy)</span> <span class="hljs-keyword">throws</span> Throwable {
        System.out.println(<span class="hljs-string">"start invoke "</span> + method.getName());
        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> method.invoke(target, args);
        System.out.println(<span class="hljs-string">"end invoke "</span> + method.getName());
        <span class="hljs-keyword">return</span> result;
    }
}


</code></pre>
<blockquote>
<p>参考：<br>
《Java核心技术》卷1<br>
《深入理解Java虚拟机》7.3<br>
java docs: <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Proxy.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Proxy.html</a><br>
<a href="https://segmentfault.com/a/1190000011291179" target="_blank" rel="noopener">Java三种代理模式：静态代理、动态代理和cglib代理</a><br>
<a href="http://xzc.fun/w/index.php?title=%E6%8F%8F%E8%BF%B0%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E7%9A%84%E5%87%A0%E7%A7%8D%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F_%E5%88%86%E5%88%AB%E8%AF%B4%E5%87%BA%E7%9B%B8%E5%BA%94%E7%9A%84%E4%BC%98%E7%BC%BA%E7%82%B9" target="_blank" rel="noopener">描述动态代理的几种实现方式 分别说出相应的优缺点</a><br>
<a href="https://my.oschina.net/robinyao/blog/811193" target="_blank" rel="noopener">JDK动态代理详解</a><br>
<a href="https://blog.csdn.net/luanlouis/article/details/24589193" target="_blank" rel="noopener">Java动态代理机制详解（JDK 和CGLIB，Javassist，ASM）</a><br>
<a href="https://blog.csdn.net/WangQYoho/article/details/77584832" target="_blank" rel="noopener">静态代理和动态代理的理解</a></p>
</blockquote>
<h3 id="后记">后记<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h3>
<p>欢迎评论、转发、分享，您的支持是我最大的动力</p>
<p>更多内容可访问我的个人博客：<a href="http://laijianfeng.org/" target="_blank" rel="noopener">http://laijianfeng.org</a></p>
<p>关注【小旋锋】微信公众号，及时接收博文推送</p>
<p><img src="./Java 动态代理详解 - whirlys - 博客园_files/20180913_001328.png" alt="关注_小旋锋_微信公众号" loading="lazy"></p>

</div>
<div class="clear"></div>
<div id="blog_post_info_block" role="contentinfo"><div id="BlogPostCategory">
    分类: 
            <a href="https://www.cnblogs.com/whirly/category/1367627.html" target="_blank">Java核心技术</a></div>
<div id="EntryTag">
    标签: 
            <a href="https://www.cnblogs.com/whirly/tag/Java/">Java</a></div>

    <div id="blog_post_info">
<div id="green_channel">
        <a href="javascript:void(0);" id="green_channel_digg" onclick="DiggIt(10154887,cb_blogId,1);green_channel_success(this,&#39;谢谢推荐！&#39;);">好文要顶</a>
        <a id="green_channel_follow" onclick="follow(&#39;7e1bbecb-9cdb-e511-9fc1-ac853d9f53cc&#39;);" href="javascript:void(0);">关注我</a>
    <a id="green_channel_favorite" onclick="AddToWz(cb_entryId);return false;" href="javascript:void(0);">收藏该文</a>
    <a id="green_channel_weibo" href="javascript:void(0);" title="分享至新浪微博" onclick="ShareToTsina()"><img src="./Java 动态代理详解 - whirlys - 博客园_files/icon_weibo_24.png" alt=""></a>
    <a id="green_channel_wechat" href="javascript:void(0);" title="分享至微信" onclick="shareOnWechat()"><img src="./Java 动态代理详解 - whirlys - 博客园_files/wechat.png" alt=""></a>
</div>
<div id="author_profile">
    <div id="author_profile_info" class="author_profile_info">
            <a href="https://home.cnblogs.com/u/whirly/" target="_blank"><img src="./Java 动态代理详解 - whirlys - 博客园_files/20190108022808.png" class="author_avatar" alt=""></a>
        <div id="author_profile_detail" class="author_profile_info">
            <a href="https://home.cnblogs.com/u/whirly/">whirlys</a><br>
            <a href="https://home.cnblogs.com/u/whirly/followers/">粉丝 - <span class="follower-count">8</span></a>
            <a href="https://home.cnblogs.com/u/whirly/followees/">关注 - <span class="following-count">1</span></a><br>
        </div>
    </div>
    <div class="clear"></div>
    <div id="author_profile_honor"></div>
    <div id="author_profile_follow" class="follow-tip">
                <a href="javascript:void(0);" onclick="follow(&#39;7e1bbecb-9cdb-e511-9fc1-ac853d9f53cc&#39;);return false;">+加关注</a>
    </div>
</div>
<div id="div_digg">
    <div class="diggit" onclick="votePost(10154887,&#39;Digg&#39;)">
        <span class="diggnum" id="digg_count">20</span>
    </div>
    <div class="buryit" onclick="votePost(10154887,&#39;Bury&#39;)">
        <span class="burynum" id="bury_count">0</span>
    </div>
    <div class="clear"></div>
    <div class="diggword" id="digg_tips">
    </div>
</div>

<script type="text/javascript">
    currentDiggType = 0;
</script></div>
    <div class="clear"></div>
    <div id="post_next_prev">

    <a href="https://www.cnblogs.com/whirly/p/10047650.html" class="p_n_p_prefix">« </a> 上一篇：    <a href="https://www.cnblogs.com/whirly/p/10047650.html" data-featured-image="" title="发布于 2018-12-01 00:02">设计模式 | 简单工厂模式及典型应用</a>
    <br>
    <a href="https://www.cnblogs.com/whirly/p/10172346.html" class="p_n_p_prefix">» </a> 下一篇：    <a href="https://www.cnblogs.com/whirly/p/10172346.html" data-featured-image="" title="发布于 2018-12-25 10:05">Java反射机制详解</a>

</div>
</div>
            </div>
            <div class="postDesc">posted @ 
<span id="post-date">2018-12-21 11:41</span>&nbsp;
<a href="https://www.cnblogs.com/whirly/">whirlys</a>&nbsp;
阅读(<span id="post_view_count">49962</span>)&nbsp;
评论(<span id="post_comment_count">6</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=10154887" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(10154887);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: &#39;b59721fd-9503-45e3-8717-08da8e583326&#39;, targetType: &#39;blogPost&#39;, targetId: &#39;10154887&#39;, targetLink: &#39;https://www.cnblogs.com/whirly/p/10154887.html&#39;, title: &#39;Java 动态代理详解&#39; })">举报</a></div>
        </div>
	    
	    
    </div><!--end: topics 文章、评论容器-->
</div>

<script>
    var cb_entryId = 10154887, cb_entryCreatedDate = '2018-12-21 11:41', cb_postType = 1, cb_postTitle = 'Java 动态代理详解';
    var allowComments = true, cb_blogId = 387481, cb_blogApp = 'whirly', cb_blogUserGuid = '7e1bbecb-9cdb-e511-9fc1-ac853d9f53cc';
    mermaidRender.render()
    markdown_highlight()
    zoomManager.apply("#cnblogs_post_body img:not(.code_img_closed):not(.code_img_opened)");
    updatePostStats(
            [cb_entryId],
            function(id, count) { $("#post_view_count").text(count) },
            function(id, count) { $("#post_comment_count").text(count) })
</script>
<a id="!comments"></a>
<div id="blog-comments-placeholder">

<div id="comment_pager_top">
    
</div>

<br>
<div class="feedback_area_title">评论列表
<div id="comment_sort" class="comment-sort" title="切换评论排序">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path d="M3 3a1 1 0 000 2h11a1 1 0 100-2H3zM3 7a1 1 0 000 2h5a1 1 0 000-2H3zM3 11a1 1 0 100 2h4a1 1 0 100-2H3zM13 16a1 1 0 102 0v-5.586l1.293 1.293a1 1 0 001.414-1.414l-3-3a1 1 0 00-1.414 0l-3 3a1 1 0 101.414 1.414L13 10.414V16z"></path>
        </svg>
    <span class="comment-sort-label">时间升序</span>
</div></div>
<div class="feedbackNoItems">
    <div class="feedbackNoItems"></div>
</div>
    <div class="feedbackItem">
        <div class="feedbackListSubtitle">
            <div class="feedbackManage">
                &nbsp;&nbsp;

<span class="comment_actions">
    <a href="javascript:void(0);" onclick="return ReplyComment(4144707, &#39;0f7N3nr0/NXUkxeAvjMPnxMhUmYcifx2A/gtM2YzDTCV05IFxX9Qxw==&#39;)">
        回复
    </a>
    <a href="javascript:void(0);" onclick="return QuoteComment(4144707, &#39;0f7N3nr0/NXUkxeAvjMPnxMhUmYcifx2A/gtM2YzDTCV05IFxX9Qxw==&#39;)">
        引用
    </a>
    
    
</span>


            </div>
            
<a href="https://www.cnblogs.com/whirly/p/10154887.html#4144707" class="layer">#1楼</a>
<a name="4144707" id="comment_anchor_4144707"></a>
 
<span class="comment_date">2018-12-21 13:47</span>

 
        <a id="a_comment_author_4144707" href="https://www.cnblogs.com/zhaoyandev/" target="_blank">zhaoyan_dev</a>

        </div>
        <div class="feedbackCon">
            
<div id="comment_body_4144707" data-format-type="Ubb" class="blog_comment_body cnblogs-ubb">
    收藏
</div>
        <div class="comment_vote">
            <span class="comment_error" style="color: red"></span>
            <a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(4144707, &#39;Digg&#39;, this.parentElement, false);">
                支持(0)
            </a>
            <a href="javascript:void(0);" class="comment_burry" onclick="return voteComment(4144707, &#39;Bury&#39;, this.parentElement, false);">
                反对(0)
            </a>
        </div>
        

        </div>
    </div>
    <div class="feedbackItem">
        <div class="feedbackListSubtitle">
            <div class="feedbackManage">
                &nbsp;&nbsp;

<span class="comment_actions">
    <a href="javascript:void(0);" onclick="return ReplyComment(4669655, &#39;a6mlnvwxHGxyGJvQYyhDXBfWSfRqOquDxThC1R4/c/AlJbVomkJLqQ==&#39;)">
        回复
    </a>
    <a href="javascript:void(0);" onclick="return QuoteComment(4669655, &#39;a6mlnvwxHGxyGJvQYyhDXBfWSfRqOquDxThC1R4/c/AlJbVomkJLqQ==&#39;)">
        引用
    </a>
    
    
</span>


            </div>
            
<a href="https://www.cnblogs.com/whirly/p/10154887.html#4669655" class="layer">#2楼</a>
<a name="4669655" id="comment_anchor_4669655"></a>
 
<span class="comment_date">2020-08-28 09:31</span>

 
        <a id="a_comment_author_4669655" href="https://www.cnblogs.com/wangyonglin/" target="_blank">wangyonglin1123</a>

        </div>
        <div class="feedbackCon">
            
<div id="comment_body_4669655" data-format-type="Markdown" class="blog_comment_body cnblogs-markdown">
    <p>这才是好的文章，这才是才华，给力 ，加油！！！！！！！！！</p>

</div>
        <div class="comment_vote">
            <span class="comment_error" style="color: red"></span>
            <a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(4669655, &#39;Digg&#39;, this.parentElement, false);">
                支持(0)
            </a>
            <a href="javascript:void(0);" class="comment_burry" onclick="return voteComment(4669655, &#39;Bury&#39;, this.parentElement, false);">
                反对(0)
            </a>
        </div>
        <span id="comment_4669655_avatar" style="display:none">
            https://pic.cnblogs.com/face/651067/20181210143956.png
        </span>

        </div>
    </div>
    <div class="feedbackItem">
        <div class="feedbackListSubtitle">
            <div class="feedbackManage">
                &nbsp;&nbsp;

<span class="comment_actions">
    <a href="javascript:void(0);" onclick="return ReplyComment(4711687, &#39;CP1OKc/NSwcJ1TgteCU0CRaNNrEZUOzarq9T7bVO8LQpOlzrmX+pFQ==&#39;)">
        回复
    </a>
    <a href="javascript:void(0);" onclick="return QuoteComment(4711687, &#39;CP1OKc/NSwcJ1TgteCU0CRaNNrEZUOzarq9T7bVO8LQpOlzrmX+pFQ==&#39;)">
        引用
    </a>
    
    
</span>


            </div>
            
<a href="https://www.cnblogs.com/whirly/p/10154887.html#4711687" class="layer">#3楼</a>
<a name="4711687" id="comment_anchor_4711687"></a>
 
<span class="comment_date">2020-10-20 17:38</span>

 
        <a id="a_comment_author_4711687" href="https://www.cnblogs.com/zhangzongle/" target="_blank">昵称加载失败~</a>

        </div>
        <div class="feedbackCon">
            
<div id="comment_body_4711687" data-format-type="Markdown" class="blog_comment_body cnblogs-markdown">
    <p>楼主写的很好。发现 CglibTest 复制的有问题吧！ 是否是下面的代码：</p>
<pre class="highlighter-hljs" highlighted="true"><code class="highlighter-hljs hljs language-java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CglibTest</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">LogInterceptor</span> <span class="hljs-variable">daoProxy</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LogInterceptor</span>();
        <span class="hljs-type">Enhancer</span> <span class="hljs-variable">enhancer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Enhancer</span>();
        enhancer.setSuperclass(UserDao.class);  <span class="hljs-comment">// 设置超类，cglib是通过继承来实现的</span>
        enhancer.setCallback(daoProxy);

        <span class="hljs-type">UserDao</span> <span class="hljs-variable">dao</span> <span class="hljs-operator">=</span> (UserDao)enhancer.create();   <span class="hljs-comment">// 创建代理类</span>
        dao.update();
        dao.select();
    }
}
</code></pre>

</div>
        <div class="comment_vote">
            <span class="comment_error" style="color: red"></span>
            <a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(4711687, &#39;Digg&#39;, this.parentElement, false);">
                支持(4)
            </a>
            <a href="javascript:void(0);" class="comment_burry" onclick="return voteComment(4711687, &#39;Bury&#39;, this.parentElement, false);">
                反对(0)
            </a>
        </div>
        <span id="comment_4711687_avatar" style="display:none">
            https://pic.cnblogs.com/face/826791/20160105153405.png
        </span>

        </div>
    </div>
    <div class="feedbackItem">
        <div class="feedbackListSubtitle">
            <div class="feedbackManage">
                &nbsp;&nbsp;

<span class="comment_actions">
    <a href="javascript:void(0);" onclick="return ReplyComment(4778571, &#39;x7F57rMAl9bXpDVQFgrqdAVORpiyi89r2HwxhnY7wwmGWHG9ZQicmg==&#39;)">
        回复
    </a>
    <a href="javascript:void(0);" onclick="return QuoteComment(4778571, &#39;x7F57rMAl9bXpDVQFgrqdAVORpiyi89r2HwxhnY7wwmGWHG9ZQicmg==&#39;)">
        引用
    </a>
    
    
</span>


            </div>
            
<a href="https://www.cnblogs.com/whirly/p/10154887.html#4778571" class="layer">#4楼</a>
<a name="4778571" id="comment_anchor_4778571"></a>
 
<span class="comment_date">2020-12-18 16:11</span>

 
        <a id="a_comment_author_4778571" href="https://home.cnblogs.com/u/1164310/" target="_blank">Shi_Er</a>

        </div>
        <div class="feedbackCon">
            
<div id="comment_body_4778571" data-format-type="Markdown" class="blog_comment_body cnblogs-markdown">
    <p>public class CglibTest {<br>
public static void main(String[] args) {<br>
Enhancer enhancer = new Enhancer();<br>
enhancer.setSuperclass(UserDao.class);  // 设置超类，cglib是通过继承来实现的<br>
enhancer.setCallback(new LogInterceptor());</p>
<pre class="highlighter-hljs" highlighted="true"><code class="highlighter-hljs hljs language-csharp">    UserDao dao = (UserDao) enhancer.create();   <span class="hljs-comment">// 创建代理类</span>
    dao.update();
    dao.<span class="hljs-keyword">select</span>();
}
</code></pre>
<p>}</p>

</div>
        <div class="comment_vote">
            <span class="comment_error" style="color: red"></span>
            <a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(4778571, &#39;Digg&#39;, this.parentElement, false);">
                支持(0)
            </a>
            <a href="javascript:void(0);" class="comment_burry" onclick="return voteComment(4778571, &#39;Bury&#39;, this.parentElement, false);">
                反对(0)
            </a>
        </div>
        

        </div>
    </div>
    <div class="feedbackItem">
        <div class="feedbackListSubtitle">
            <div class="feedbackManage">
                &nbsp;&nbsp;

<span class="comment_actions">
    <a href="javascript:void(0);" onclick="return ReplyComment(5062517, &#39;FDQqWkAW8RV7O7D7kHNRIzQsYAiTz4QleAb3X+78Z5CruQV7MFIHrQ==&#39;)">
        回复
    </a>
    <a href="javascript:void(0);" onclick="return QuoteComment(5062517, &#39;FDQqWkAW8RV7O7D7kHNRIzQsYAiTz4QleAb3X+78Z5CruQV7MFIHrQ==&#39;)">
        引用
    </a>
    
    
</span>


            </div>
            
<a href="https://www.cnblogs.com/whirly/p/10154887.html#5062517" class="layer">#5楼</a>
<a name="5062517" id="comment_anchor_5062517"></a>
 
<span class="comment_date">2022-05-31 13:39</span>

 
        <a id="a_comment_author_5062517" href="https://home.cnblogs.com/u/2783324/" target="_blank">死亡的艺术</a>

        </div>
        <div class="feedbackCon">
            
<div id="comment_body_5062517" data-format-type="Markdown" class="blog_comment_body cnblogs-markdown">
    <p>写得很棒！！！</p>

</div>
        <div class="comment_vote">
            <span class="comment_error" style="color: red"></span>
            <a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(5062517, &#39;Digg&#39;, this.parentElement, false);">
                支持(0)
            </a>
            <a href="javascript:void(0);" class="comment_burry" onclick="return voteComment(5062517, &#39;Bury&#39;, this.parentElement, false);">
                反对(0)
            </a>
        </div>
        

        </div>
    </div>
    <div class="feedbackItem">
        <div class="feedbackListSubtitle">
            <div class="feedbackManage">
                &nbsp;&nbsp;

<span class="comment_actions">
    <a href="javascript:void(0);" onclick="return ReplyComment(5062683, &#39;lsVtnokW35Q5teVrRAuMBmFKf0szc4tFX+KZeF3L1to2CHuTmLQTKw==&#39;)">
        回复
    </a>
    <a href="javascript:void(0);" onclick="return QuoteComment(5062683, &#39;lsVtnokW35Q5teVrRAuMBmFKf0szc4tFX+KZeF3L1to2CHuTmLQTKw==&#39;)">
        引用
    </a>
    
    
</span>


            </div>
            
<a href="https://www.cnblogs.com/whirly/p/10154887.html#5062683" class="layer">#6楼</a>
<a name="5062683" id="comment_anchor_5062683"></a>
    <span id="comment-maxId" style="display: none">5062683</span>
    <span id="comment-maxDate" style="display: none">2022/5/31 下午8:21:34</span>
 
<span class="comment_date">2022-05-31 20:21</span>

 
        <a id="a_comment_author_5062683" href="https://www.cnblogs.com/wha6239/" target="_blank">一只烤鸭朝北走</a>

        </div>
        <div class="feedbackCon">
            
<div id="comment_body_5062683" data-format-type="Markdown" class="blog_comment_body cnblogs-markdown">
    <p>好文，必须顶起来，猜测一下哈，cglib生成的代理对象的内部，应该是是持有了methodInterceptor的引用，在代理对象调用方法时候，触发了methodInterceptor实现类中的intercept()方法。</p>

</div>
        <div class="comment_vote">
            <span class="comment_error" style="color: red"></span>
            <a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(5062683, &#39;Digg&#39;, this.parentElement, false);">
                支持(0)
            </a>
            <a href="javascript:void(0);" class="comment_burry" onclick="return voteComment(5062683, &#39;Bury&#39;, this.parentElement, false);">
                反对(0)
            </a>
        </div>
        <span id="comment_5062683_avatar" style="display:none">
            https://pic.cnblogs.com/face/1139198/20220902171114.png
        </span>

        </div>
    </div>

<div id="comment_pager_bottom">
    
</div>


</div>
<div id="comment_form" class="commentform">
    <a name="commentform"></a>
    <div id="divCommentShow"></div>
    <div id="comment_nav"><span id="span_refresh_tips"></span><a href="javascript:void(0);" onclick="return RefreshCommentList();" id="lnk_RefreshComments" runat="server" clientidmode="Static">刷新评论</a><a href="https://www.cnblogs.com/whirly/p/10154887.html#" onclick="return RefreshPage();">刷新页面</a><a href="https://www.cnblogs.com/whirly/p/10154887.html#top">返回顶部</a></div>
    <div id="comment_form_container" style="visibility: visible;"><script type="text/javascript" src="./Java 动态代理详解 - whirlys - 博客园_files/mention.min.js.下载"></script>
<div id="commentform_title">发表评论</div>
<span id="tip_comment" style="color:Red"></span>
<div class="commentbox_main comment_textarea">
    <div class="commentbox_title">
        <div class="commentbox_title_left">
            <span id="btn_edit_comment" class="commentbox_tab active" title="编辑评论">编辑</span>
            <span id="btn_preview_comment" class="commentbox_tab" title="Markdown 预览">预览</span>
        </div>
        <div class="commentbox_title_right">
            <span id="ubb_bold" class="comment_icon" alt="粗体" title="添加粗体(Ctrl + B)">
                <svg class="comment_svg" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <g fill-rule="evenodd">
                        <path d="m13.221 19c1.4414 0 2.5793-0.27451 3.3759-0.82353 0.92931-0.66667 1.4034-1.7059 1.4034-3.1176 0-0.94118-0.22759-1.7059-0.66379-2.2549-0.45517-0.56863-1.119-0.94118-2.0103-1.1176 0.68276-0.27451 1.1948-0.64706 1.5552-1.1569 0.36034-0.54902 0.55-1.2157 0.55-2 0-1.0588-0.36034-1.902-1.0621-2.5294-0.75862-0.66667-1.8207-1-3.1672-1h-6.2017v14h6.2207zm-0.82196-8h-3.3987v-4h3.4367c0.91139 0 1.557 0.15686 1.9747 0.47059 0.37975 0.29412 0.58861 0.78431 0.58861 1.451 0 0.72549-0.20886 1.2549-0.58861 1.5882-0.39873 0.31373-1.0633 0.4902-2.0127 0.4902zm0.52612 6h-3.9249v-4h3.9855c1.052 0 1.8208 0.16216 2.3064 0.48649 0.46532 0.32432 0.70809 0.84685 0.70809 1.5856 0 0.72072-0.3237 1.2252-0.9711 1.5495-0.50578 0.25225-1.2139 0.37838-2.104 0.37838z" fill-rule="nonzero" stroke-width=".35"></path>
                    </g>
                </svg>
            </span>
            <span id="ubb_url" class="comment_icon" title="添加链接(Ctrl + K)" alt="链接">
                <svg class="comment_svg comment_svg_stroke" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <g fill-rule="evenodd">
                        <g transform="translate(4 4)" fill-rule="nonzero" stroke-width=".4">
                            <path d="m6.304 9.696c-0.288-0.288-0.512-0.608-0.704-0.992-0.16-0.32-0.032-0.704 0.288-0.864 0.32-0.16 0.704-0.032 0.864 0.288 0.128 0.224 0.256 0.448 0.448 0.64 0.928 0.928 2.432 0.928 3.36 0l3.36-3.328c0.928-0.928 0.928-2.432 0-3.36s-2.432-0.928-3.36 0l-2.272 2.272c-0.256 0.256-0.64 0.256-0.896 0-0.256-0.256-0.256-0.64 0-0.896l2.272-2.272c1.44-1.44 3.744-1.44 5.184 0 1.44 1.44 1.44 3.744 0 5.184l-3.36 3.296c-0.704 0.704-1.632 1.088-2.592 1.088-0.928 0-1.856-0.352-2.592-1.056z"></path>
                            <path d="m3.776 15.808c-0.992 0-1.888-0.384-2.592-1.056-1.44-1.44-1.44-3.744 0-5.184l3.328-3.328c1.44-1.44 3.744-1.44 5.184 0 0.288 0.288 0.544 0.64 0.736 1.024 0.16 0.32 0 0.704-0.32 0.864-0.32 0.16-0.704 0-0.864-0.32-0.128-0.256-0.288-0.48-0.48-0.672-0.928-0.928-2.432-0.928-3.36 0l-3.296 3.328c-0.928 0.928-0.928 2.432 0 3.36 0.448 0.448 1.056 0.704 1.664 0.704 0.608 0 1.248-0.256 1.664-0.704l2.112-2.112c0.256-0.256 0.64-0.256 0.896 0s0.256 0.64 0 0.896l-2.112 2.112c-0.672 0.704-1.568 1.088-2.56 1.088z"></path>
                        </g>
                    </g>
                </svg>
            </span>
            <span id="ubb_code" class="comment_icon" title="添加代码(Ctrl + `)" alt="代码">
                <svg class="comment_svg comment_svg_stroke" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <g fill-rule="evenodd">
                        <g transform="translate(16 6)" stroke-linecap="round" stroke-width="2">
                            <line x1=".5" x2="4.5" y1=".7" y2="6.3"></line>
                            <line transform="translate(2.5 9.1) scale(1 -1) translate(-2.5 -9.1)" x1=".5" x2="4.5" y1="6.3" y2="11.9"></line>
                        </g>
                        <g transform="translate(3 6.1)" stroke-linecap="round" stroke-width="2">
                            <line transform="translate(2.5 3.5) scale(-1 1) translate(-2.5 -3.5)" x1=".5" x2="4.5" y1=".7" y2="6.3"></line>
                            <line transform="translate(2.5 9.1) scale(-1) translate(-2.5 -9.1)" x1=".5" x2="4.5" y1="6.3" y2="11.9"></line>
                        </g>
                        <path transform="translate(12 12.5) scale(1 -1) translate(-12 -12.5)" d="m10.778 7.1249c0.50008-0.11366 0.9978 0.16911 1.1643 0.64128l0.032406 0.11223 2 8.8c0.1224 0.53855-0.21496 1.0744-0.75351 1.1968-0.50008 0.11366-0.9978-0.16911-1.1643-0.64128l-0.032406-0.11223-2-8.8c-0.1224-0.53855 0.21496-1.0744 0.75351-1.1968z" fill-rule="nonzero" stroke-width=".25"></path>
                    </g>
                </svg>
            </span>
            <span id="ubb_quote" class="comment_icon" title="添加引用(Ctrl + Q)" alt="引用">
                <svg class="comment_svg" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <g fill-rule="evenodd">
                        <g transform="translate(5 4)" fill-rule="nonzero" stroke-width=".25">
                            <path d="m5.0013 15v-5.2702h-2.8008c-0.13413-3.3762 1.2004-6.2143 4.0009-8.5135l-1.2-1.2163c-3.335 2.2996-5.0013 5.8119-5.0013 10.54v4.4595h5.0013-1.285e-5zm8.7987 0v-5.2702h-2.8008c-0.13453-3.3762 1.2-6.2143 4.0009-8.5135l-1.2-1.2163c-3.335 2.2996-5.0013 5.8119-5.0013 10.54v4.4595h5.0013-1.28e-5z"></path>
                        </g>
                    </g>
                </svg>
            </span>
            <span id="ubb_img" class="comment_icon" alt="图片" title="上传图片(Ctrl + I)">
                <svg class="comment_svg" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <g fill-rule="evenodd">
                        <g transform="translate(3 3.8)" fill-rule="nonzero">
                            <path d="m14.1 0.58235h-11.2c-1.32 0-2.4 1.0482-2.4 2.3294v10.871c0 1.2812 1.08 2.3294 2.4 2.3294h11.2c1.32 0 2.4-1.0482 2.4-2.3294v-10.871c0-1.2812-1.08-2.3294-2.4-2.3294zm0.7 13.569-3.63-3.4165 1.33-1.2909c0.21-0.20382 0.59-0.20382 0.8 0l1.6 1.5529v2.7856c0 0.13588-0.04 0.26206-0.1 0.36882zm-11.9-12.016h11.2c0.44 0 0.8 0.34941 0.8 0.77647v5.8915l-0.47-0.45618c-0.84-0.825-2.22-0.825-3.07 0l-1.35 1.3103-2.39-2.2421c-0.85-0.825-2.22-0.825-3.05-0.019412l-2.48 2.2615v-6.7456c0.01-0.42706 0.37-0.77647 0.81-0.77647zm-0.8 11.647v-1.9897l3.6-3.2806c0.21-0.20382 0.58-0.21353 0.81 0.0097059l6.43 6.0371h-10.04c-0.44 0-0.8-0.33971-0.8-0.77647z"></path>
                            <ellipse cx="10.5" cy="6.4059" rx="1" ry="1"></ellipse>
                        </g>
                    </g>
                </svg>
            </span>
        </div>
    </div>
    <div style="display:none">
        <span id="comment_edit_id"></span>
        <span id="span_parentcomment_id"></span>
        <span id="span_parent_id"></span>
        <span id="span_comment_replyto"></span>
        <span id="span_comment_posted"></span>
        <span id="span_current_user_id">b59721fd-9503-45e3-8717-08da8e583326</span>
    </div>
    <textarea id="tbCommentBody" placeholder="支持 Markdown"></textarea>
    <div id="tbCommentBodyPreview" class="feedbackCon" style="display: none">
        <div id="tbCommentBodyPreviewBody" class="blog_comment_body comment_preview cnblogs-markdown"></div>
    </div>
    <div class="commentbox_footer">
        <span>&nbsp;</span>
        <span href="javascript:void(0)" id="ubb_auto_completion" class="comment_option">
            <svg style="display: none" id="comment_auto_completion_on" viewBox="0 0 1080 1080" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2"><path d="M406.724 908.504c-89.02 0-157.885-32.319-206.594-96.957-49.549-64.639-73.903-155.795-73.903-274.299 0-116.017 24.354-206.345 73.903-270.155 48.71-63.81 117.574-95.3 206.594-95.3h19.316l-7.559 72.925h-3.359c-65.505 0-115.054 25.69-150.326 77.069-35.272 50.55-52.908 122.647-52.908 215.461 0 94.472 17.636 168.226 52.908 220.434 35.272 51.379 84.82 77.897 150.326 77.897h3.36l7.558 72.925h-19.316zm266.548 0c89.02 0 157.885-32.319 206.594-96.957 49.55-64.639 73.904-155.795 73.904-274.299 0-116.017-24.355-206.345-73.904-270.155-48.709-63.81-117.573-95.3-206.594-95.3h-19.315l7.558 72.925h3.36c65.505 0 115.054 25.69 150.326 77.069 35.272 50.55 52.908 122.647 52.908 215.461 0 94.472-17.636 168.226-52.908 220.434-35.272 51.379-84.821 77.897-150.327 77.897h-3.359l-7.558 72.925h19.315zm-94.068-65.897c0 31.514.854 54.433 1.708 68.758 1.709 14.325 3.417 25.784 6.835 34.38 2.563 8.594 6.834 14.324 12.814 20.054 5.126 5.73 14.523 11.46 27.337 17.189v34.38H451.914v-34.38c17.086-7.162 29.046-15.757 35.026-24.352 5.126-10.027 9.398-22.92 11.106-38.676 1.709-17.19 2.563-42.974 2.563-77.353V238.109c0-32.947-.854-55.866-1.709-71.623-1.708-14.325-4.271-25.784-6.834-32.947-3.417-8.595-7.689-15.757-12.814-20.054-5.126-5.73-14.523-10.027-27.338-17.19V61.916h175.984v34.38c-11.96 5.73-21.357 11.459-26.483 15.756-5.125 5.73-9.397 11.46-12.814 20.055-3.417 7.162-5.98 18.622-6.834 34.379-1.709 15.757-2.563 38.676-2.563 71.623v604.498z" fill-rule="nonzero"></path></svg>
            <svg id="comment_auto_completion_off" viewBox="0 0 1080 1080" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2"><path d="M242.96 223.172l59.627 58.009c-14.277 10.773-26.874 24.032-37.791 40.606-35.272 50.55-52.908 122.647-52.908 215.461 0 94.472 17.636 168.226 52.908 220.434 35.272 51.379 84.82 77.897 150.326 77.897h3.36l7.558 72.925h-19.316c-89.02 0-157.885-32.319-206.594-96.957-49.549-64.639-73.903-155.795-73.903-274.299 0-116.017 24.354-206.345 73.903-270.155 12.597-16.574 26.874-31.49 42.83-43.921zm36.952-23.204c36.112-19.06 78.943-28.175 126.812-28.175h19.316l-7.559 72.925h-3.359c-27.714 0-52.908 4.144-74.743 14.088l-60.467-58.838zM805.123 770.94l60.466 58.01c-47.869 53.036-111.695 79.554-192.317 79.554h-19.315l7.558-72.925h3.36c59.626 0 105.816-21.546 140.248-64.638zm23.515-37.29c26.034-49.723 39.47-115.19 39.47-196.402 0-92.814-17.635-164.91-52.907-215.461-35.272-51.38-84.821-77.069-150.327-77.069h-3.359l-7.558-72.925h19.315c89.02 0 157.885 31.49 206.594 95.3 49.55 63.81 73.904 154.138 73.904 270.155 0 108.56-20.996 194.744-62.146 257.725l-62.986-61.324zM500.609 474.465l78.595 75.92v292.222c0 31.514.854 54.433 1.708 68.758 1.709 14.325 3.417 25.784 6.835 34.38 2.563 8.594 6.834 14.324 12.814 20.054 5.126 5.73 14.523 11.46 27.337 17.189v34.38H451.914v-34.38c17.086-7.162 29.046-15.757 35.026-24.352 5.126-10.027 9.398-22.92 11.106-38.676 1.709-17.19 2.563-42.974 2.563-77.353V474.465zm0-60.164V238.11c0-32.947-.854-55.866-1.709-71.623-1.708-14.325-4.271-25.784-6.834-32.947-3.417-8.595-7.689-15.757-12.814-20.054-5.126-5.73-14.523-10.027-27.338-17.19v-34.38h175.984v34.38c-11.96 5.73-21.357 11.459-26.483 15.756-5.125 5.73-9.397 11.46-12.814 20.055-3.417 7.162-5.98 18.622-6.834 34.379-1.709 15.757-2.563 38.676-2.563 71.623v253.545l-78.595-77.353z"></path><path d="M153.103 132.024l805.45 783.706-44.277 45.505-805.45-783.706z"></path></svg>
            <span class="inline_middle">自动补全</span>
        </span>
    </div>
</div>
<p id="commentbox_opt">
    <input id="btn_comment_submit" type="button" class="comment_btn" title="提交评论(Ctrl + Enter)" value="提交评论">
    <span id="span_comment_canceledit" style="display:none"><a href="javascript:void(0);" onclick="return CancelCommentEdit()">不改了</a></span>
    <a href="javascript:void(0);" onclick="return account.logout();">退出</a>
            <a id="commentbox_opt_sub" href="javascript:void(0);" title="订阅后有新评论时会邮件通知您" onclick="commentManager.Subscribe()">订阅评论</a>
</p>
<div id="tip_comment2" style="color:Red"></div>
<p>[Ctrl+Enter快捷键提交]</p>
<script>var commentEditor = initCommentEditor("tbCommentBody");</script>

</div>
    <div class="ad_text_commentbox" id="ad_text_under_commentbox"></div>
        <div id="cnblogs_ch"><a href="https://curl.qcloud.com/k19RDMHo" target="_blank" onclick="gtag(&#39;event&#39;, &#39;click&#39;, {&#39;event_category&#39;: &#39;ad&#39;, &#39;event_label&#39;: &#39;T2-腾讯云&#39;})">【推荐】腾讯云多款云产品1折起，买云服务器送免费机器</a><br><a href="https://click.ctyun.cn/?track=source_bokeyuan-medium_cps-content_se430382" target="_blank" onclick="gtag(&#39;event&#39;, &#39;click&#39;, {&#39;event_category&#39;: &#39;ad&#39;, &#39;event_label&#39;: &#39;T2-天翼云&#39;})">【推荐】天翼云新客特惠，云主机1核2G低至33.43元/年</a><br></div>
    <div id="opt_under_post"></div>
    <div id="cnblogs_c1" class="under-post-card">
            <div id="div-gpt-ad-1592365906576-0" style="width: 300px; height: 250px;"></div>
    </div>
    <div id="under_post_card1"><div class="under-post-card">
<b>编辑推荐：</b>
<br>

· <a href="https://www.cnblogs.com/Finley/p/16827147.html" target="_blank">从小白到架构师(3): 揭开分布式数据库的面纱</a>
    <br>
· <a href="https://www.cnblogs.com/jackson0714/p/redis_transaction.html" target="_blank">一次 Redis 事务使用不当引发的生产事故</a>
    <br>
· <a href="https://www.cnblogs.com/dino623/p/iPhone14ProTextAnimation.html" target="_blank">[WPF] 抄抄超强的苹果官网滚动文字特效实现</a>
    <br>
· <a href="https://www.cnblogs.com/sheng-jie/p/MassTransit-NET-Distributed-Application-Framework.html" target="_blank">MassTransit | .NET 分布式应用框架</a>
    <br>
· <a href="https://www.cnblogs.com/god23bin/p/check-duplication-in-java.html" target="_blank">查重原来是这样实现的啊！</a>
    <br>
</div></div>
    <div id="under_post_card2"><div class="itnews under-post-card">
    <b>即构专区</b>:
    <br>
 ·          <a href="https://brands.cnblogs.com/zego/p/15388" target="_blank">基于电商直播SDK快速实现一个淘宝直播APP【内附源码】 </a>
        <br>
 ·          <a href="https://brands.cnblogs.com/zego/p/15379" target="_blank">快速构建元宇宙专属虚拟形象，实时互动超酷炫 </a>
        <br>
 ·          <a href="https://brands.cnblogs.com/zego/p/15380" target="_blank">教你30分钟快速搭建直播间</a>
        <br>
 ·          <a href="https://brands.cnblogs.com/zego/p/15378" target="_blank">用 ZEGO Avatar 做一个虚拟人｜虚拟主播直播解决方案 </a>
        <br>
 ·          <a href="https://brands.cnblogs.com/zego/p/15384" target="_blank">如何快速实现直播美颜功能 - 接入美颜SDK详解</a>
        <br>
</div></div>
    <div id="HistoryToday" class="under-post-card" style="display: none;"></div>
    <script type="text/javascript">
        var commentManager = new blogCommentManager();
        commentManager.renderComments(0);
        fixPostBody();

            window.tocManager.displayDisableTocTips = false;
            window.tocManager.generateToc();
            
                setTimeout(function() { countViews(cb_blogId, cb_entryId); }, 50);
            
            deliverT2();
            deliverC1C2();
            loadNewsAndKb();
            
                LoadPostCategoriesTags(cb_blogId, cb_entryId);
            
            LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
            GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate, cb_postType);
            loadOptUnderPost();
            GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);
                </script>
</div>

	</div><!--end: forFlow -->
	</div><!--end: mainContent 主体内容容器-->
	<div id="sideBar">
		<div id="sideBarMain">
			<div id="sidebar_news" class="newsItem"><!--done-->
<h3 class="catListTitle">公告</h3>

<div id="blog-news">
    
    <div id="profile_block">
        昵称：
        <a href="https://home.cnblogs.com/u/whirly/">
            whirlys
        </a>
        <br>
        园龄：
        <a href="https://home.cnblogs.com/u/whirly/" title="入园时间：2016-02-25">
            6年8个月
        </a>
        <br>
        粉丝：
        <a class="follower-count" href="https://home.cnblogs.com/u/whirly/followers/">
            8
        </a>
        <br>
        关注：
        <a class="folowing-count" href="https://home.cnblogs.com/u/whirly/followees/">
            1
        </a>
        <div id="p_b_follow" class="follow-tip">
<a href="javascript:void(0)" onclick="follow(&#39;7e1bbecb-9cdb-e511-9fc1-ac853d9f53cc&#39;)">+加关注</a></div>
        <script>getFollowStatus('7e1bbecb-9cdb-e511-9fc1-ac853d9f53cc');</script>
    </div>
</div>

</div>
<div id="sidebar_c3"></div>
			<div id="blog-calendar" style="">

<table id="blogCalendar" class="Cal" cellspacing="0" cellpadding="0" title="Calendar" border="0">
    <tbody>
        <tr>
            <td colspan="7">
                <table class="CalTitle" cellspacing="0" border="0">
                    <tbody>
                        <tr>
                            <td class="CalNextPrev">
                                <a href="javascript:void(0);" onclick="loadBlogCalendar(&#39;2022/09/27&#39;); return false;">&lt;</a>
                            </td>
                            <td align="center">2022年10月</td>
                            <td align="right" class="CalNextPrev">
                                <a href="javascript:void(0);" onclick="loadBlogCalendar(&#39;2022/11/27&#39;); return false;">&gt;</a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </td>
        </tr>
    <tr>
        <th class="CalDayHeader" align="center" abbr="日" scope="col">日</th>
        <th class="CalDayHeader" align="center" abbr="一" scope="col">一</th>
        <th class="CalDayHeader" align="center" abbr="二" scope="col">二</th>
        <th class="CalDayHeader" align="center" abbr="三" scope="col">三</th>
        <th class="CalDayHeader" align="center" abbr="四" scope="col">四</th>
        <th class="CalDayHeader" align="center" abbr="五" scope="col">五</th>
        <th class="CalDayHeader" align="center" abbr="六" scope="col">六</th>
    </tr>
            <tr>
                            <td class="CalOtherMonthDay" align="center">25</td>
                            <td class="CalOtherMonthDay" align="center">26</td>
                            <td class="CalOtherMonthDay" align="center">27</td>
                            <td class="CalOtherMonthDay" align="center">28</td>
                            <td class="CalOtherMonthDay" align="center">29</td>
                            <td class="CalOtherMonthDay" align="center">30</td>
                    <td class="CalWeekendDay" align="center">
                        1
                    </td>
            </tr>
                <tr>
                        <td class="CalWeekendDay" align="center">
                            2
                        </td>
                            <td class="" align="center">
                                3
                            </td>
                            <td class="" align="center">
                                4
                            </td>
                            <td class="" align="center">
                                5
                            </td>
                            <td class="" align="center">
                                6
                            </td>
                            <td class="" align="center">
                                7
                            </td>
                        <td class="CalWeekendDay" align="center">
                            8
                        </td>
                </tr>
                <tr>
                        <td class="CalWeekendDay" align="center">
                            9
                        </td>
                            <td class="" align="center">
                                10
                            </td>
                            <td class="" align="center">
                                11
                            </td>
                            <td class="" align="center">
                                12
                            </td>
                            <td class="" align="center">
                                13
                            </td>
                            <td class="" align="center">
                                14
                            </td>
                        <td class="CalWeekendDay" align="center">
                            15
                        </td>
                </tr>
                <tr>
                        <td class="CalWeekendDay" align="center">
                            16
                        </td>
                            <td class="" align="center">
                                17
                            </td>
                            <td class="" align="center">
                                18
                            </td>
                            <td class="" align="center">
                                19
                            </td>
                            <td class="" align="center">
                                20
                            </td>
                            <td class="" align="center">
                                21
                            </td>
                        <td class="CalWeekendDay" align="center">
                            22
                        </td>
                </tr>
                <tr>
                        <td class="CalWeekendDay" align="center">
                            23
                        </td>
                            <td class="" align="center">
                                24
                            </td>
                            <td class="" align="center">
                                25
                            </td>
                            <td class="" align="center">
                                26
                            </td>
                            <td class="CalTodayDay" align="center">
                                27
                            </td>
                            <td class="" align="center">
                                28
                            </td>
                        <td class="CalWeekendDay" align="center">
                            29
                        </td>
                </tr>
                <tr>
                        <td class="CalWeekendDay" align="center">
                            30
                        </td>
                            <td class="" align="center">
                                31
                            </td>
                            <td class="CalOtherMonthDay" align="center">
                                1
                            </td>
                            <td class="CalOtherMonthDay" align="center">
                                2
                            </td>
                            <td class="CalOtherMonthDay" align="center">
                                3
                            </td>
                            <td class="CalOtherMonthDay" align="center">
                                4
                            </td>
                        <td class="CalOtherMonthDay" align="center">
                            5
                        </td>
                </tr>
    </tbody>
</table></div><script>loadBlogDefaultCalendar();</script>			
			<div id="leftcontentcontainer">
				<div id="blog-sidecolumn"><!-- 搜索 -->
<div id="sidebar_search" class="sidebar-block">
    <div id="sidebar_search" class="mySearch">
        <h3 class="catListTitle">搜索</h3>
        <div id="sidebar_search_box">
            <div id="widget_my_zzk" class="div_my_zzk">
                <input type="text" id="q" onkeydown="return zzk_go_enter(event);" class="input_my_zzk">&nbsp;<input onclick="zzk_go()" type="button" value="找找看" id="btnZzk" class="btn_my_zzk">
            </div>
            <div id="widget_my_google" class="div_my_zzk">
                <input type="text" name="google_q" id="google_q" onkeydown="return google_go_enter(event);" class="input_my_zzk">&nbsp;<input onclick="google_go()" type="button" value="谷歌搜索" class="btn_my_zzk">
            </div>
        </div>
    </div>
</div>

<!-- 常用链接 -->


<!-- 最新随笔 -->


<!-- 我的标签 -->
<div id="sidebar_toptags" class="sidebar-block"><div class="catListTag">
<h3 class="catListTitle">我的标签</h3>
<ul>
        <li>
            <a href="https://www.cnblogs.com/whirly/tag/Java/">Java<span class="tag-count">(2)</span></a>
        </li>
        <li>
            <a href="https://www.cnblogs.com/whirly/tag/binlog/">binlog<span class="tag-count">(1)</span></a>
        </li>
        <li>
            <a href="https://www.cnblogs.com/whirly/tag/mysql/">mysql<span class="tag-count">(1)</span></a>
        </li>
    

</ul>
</div>

</div>

<!-- 积分与排名 -->


<!-- 随笔分类、随笔档案、文章分类、新闻分类、相册、链接 -->
<div id="sidebar_categories">

    <div id="sidebar_postcategory" class="catListPostCategory sidebar-block">
        <h3 class="catListTitle">
            
    <a class="sidebar-card-title-a" href="https://www.cnblogs.com/whirly/categories">随笔分类</a>



        </h3>

        <ul>

                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/whirly/category/1378483.html" class="category-item-link" rel="" target="">Elasticsearch原理与实践(1)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/whirly/category/1367627.html" class="category-item-link" rel="" target="">Java核心技术(2)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/whirly/category/1416703.html" class="category-item-link" rel="" target="">大数据(2)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/whirly/category/1353424.html" class="category-item-link" rel="" target="">设计模式(3)</a>
 
                </li>                
            
        </ul>


    </div>    
    <div id="sidebar_postarchive" class="catListPostArchive sidebar-block">
        <h3 class="catListTitle">
            
随笔档案


        </h3>

        <ul>

                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/whirly/archive/2021/01.html" class="category-item-link" rel="" target="">2021年1月(1)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/whirly/archive/2019/03.html" class="category-item-link" rel="" target="">2019年3月(2)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/whirly/archive/2019/01.html" class="category-item-link" rel="" target="">2019年1月(4)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/whirly/archive/2018/12.html" class="category-item-link" rel="" target="">2018年12月(3)</a>
 
                </li>                
            
        </ul>


    </div>    
</div>

<!-- 最新评论 -->
<!-- 阅读排行榜 -->
<div id="sidebar_topviewedposts" class="sidebar-block"><div class="catListView">
    <h3 class="catListTitle">
        <a href="https://www.cnblogs.com/whirly/most-viewed" class="sidebar-card-title-a">
    阅读排行榜
</a>

    </h3>
    <div id="TopViewPostsBlock">
        <ul style="word-break:break-all">
                    <li>
                        <a href="https://www.cnblogs.com/whirly/p/10154887.html">
                            1. Java 动态代理详解(49956)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/whirly/p/10513868.html">
                            2. MySQL Binlog 解析工具 Maxwell 详解(6332)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/whirly/p/10511344.html">
                            3. MySQL Binlog 介绍(2427)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/whirly/p/14290689.html">
                            4. 虾皮Shopee社招面经分享（大数据开发方向），附内推方式(1535)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/whirly/p/10263248.html">
                            5. 设计模式 | 解释器模式及典型应用(954)
                        </a>
                    </li>
        </ul>
    </div>
</div></div>

<!-- 评论排行榜 -->
<div id="sidebar_topcommentedposts" class="sidebar-block"><div class="catListFeedback">
    <h3 class="catListTitle">
        <a href="https://www.cnblogs.com/whirly/most-commented" class="sidebar-card-title-a">评论排行榜</a>

    </h3>
    <div id="TopFeedbackPostsBlock">
        <ul style="word-break:break-all">
                    <li>
                        <a href="https://www.cnblogs.com/whirly/p/10154887.html">
                            1. Java 动态代理详解(6)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/whirly/p/10511344.html">
                            2. MySQL Binlog 介绍(1)
                        </a>
                    </li>
        </ul>
    </div>
</div></div>

<!-- 推荐排行榜 -->
<div id="sidebar_topdiggedposts" class="sidebar-block">
<div id="topdigg_posts_wrap">
    <div class="catListView">
        <h3 class="catListTitle">
            <a href="https://www.cnblogs.com/whirly/most-liked" class="sidebar-card-title-a">推荐排行榜</a>

        </h3>
        <div id="TopDiggPostsBlock">
            <ul style="word-break: break-all">
                        <li>
                            <a href="https://www.cnblogs.com/whirly/p/10154887.html">
                                1. Java 动态代理详解(20)
                            </a>
                        </li>
                        <li>
                            <a href="https://www.cnblogs.com/whirly/p/10513868.html">
                                2. MySQL Binlog 解析工具 Maxwell 详解(2)
                            </a>
                        </li>
                        <li>
                            <a href="https://www.cnblogs.com/whirly/p/14290689.html">
                                3. 虾皮Shopee社招面经分享（大数据开发方向），附内推方式(1)
                            </a>
                        </li>
                        <li>
                            <a href="https://www.cnblogs.com/whirly/p/10231688.html">
                                4. 设计模式 | 单例模式及典型应用(1)
                            </a>
                        </li>
            </ul>
        </div>
    </div>
</div></div><div id="sidebar_recentcomments" class="sidebar-block"><div class="catListComment">
<h3 class="catListTitle"><a href="https://www.cnblogs.com/whirly/comments" class="sidebar-card-title-a">最新评论</a></h3>
    <div class="RecentCommentBlock">
        <ul>
                <li class="recent_comment_title"><a href="https://www.cnblogs.com/whirly/p/10154887.html">1. Re:Java 动态代理详解</a></li>
                <li class="recent_comment_body">好文，必须顶起来，猜测一下哈，cglib生成的代理对象的内部，应该是是持有了methodInterceptor的引用，在代理对象调用方法时候，触发了methodInterceptor实现类中的inte...</li>
                <li class="recent_comment_author">--一只烤鸭朝北走</li>
                <li class="recent_comment_title"><a href="https://www.cnblogs.com/whirly/p/10154887.html">2. Re:Java 动态代理详解</a></li>
                <li class="recent_comment_body"><p>写得很棒！！！</p>
</li>
                <li class="recent_comment_author">--死亡的艺术</li>
                <li class="recent_comment_title"><a href="https://www.cnblogs.com/whirly/p/10154887.html">3. Re:Java 动态代理详解</a></li>
                <li class="recent_comment_body">public class CglibTest { public static void main(String[] args) { Enhancer enhancer = new Enhancer()...</li>
                <li class="recent_comment_author">--Shi_Er</li>
                <li class="recent_comment_title"><a href="https://www.cnblogs.com/whirly/p/10154887.html">4. Re:Java 动态代理详解</a></li>
                <li class="recent_comment_body">楼主写的很好。发现 CglibTest 复制的有问题吧！ 是否是下面的代码： public class CglibTest { public static void main(String[] arg...</li>
                <li class="recent_comment_author">--无聊想被打</li>
                <li class="recent_comment_title"><a href="https://www.cnblogs.com/whirly/p/10154887.html">5. Re:Java 动态代理详解</a></li>
                <li class="recent_comment_body"><p>这才是好的文章，这才是才华，给力 ，加油！！！！！！！！！</p>
</li>
                <li class="recent_comment_author">--wangyonglin1123</li>
        </ul>
    </div>
</div>

</div>


</div>
                    <script>loadBlogSideColumn();</script>
			</div>			
		</div><!--end: sideBarMain -->
	</div><!--end: sideBar 侧边栏容器 -->
	<div class="clear"></div>
	</div><!--end: main -->
	<div class="clear"></div>
	<div id="footer">
		<!--done-->
Copyright © 2022 whirlys
<br><span id="poweredby">Powered by .NET 6 on Kubernetes</span>



	</div><!--end: footer -->
</div><!--end: home 自定义的最大容器 -->





<input type="hidden" id="antiforgery_token" value="CfDJ8NfDHj8mnYFAmPyhfXwJojeNWLvfw1DYq2C3i2Ew4xLwQ1tuFtlC1Qt1ePqOZInDkUG_R34XSWP1ZEl1CXg8uhvigCgJ1AnuqHmPshYndleyk8TWJzdB-vT4aTSmXlfJ5q-Kobqd_7QwuEyhs16U4Dos5ekGRoGfZDD5SxyA2NaS16rmCaACvZCV7U3KNDSAcA">
<script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-476124-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    var kv = getGACustom();
    if (kv) {
        gtag('set', kv);
    }
    gtag('config', 'UA-476124-1');
</script>
<script defer="" src="https://hm.baidu.com/hm.js?866c9be12d4a814454792b1fd0fed295"></script>

</body></html>